  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------
SecureApi::Test: test_truth
---------------------------
  [1m[35m (4.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------
SecureApi::Test: test_truth
---------------------------
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------
SecureApi::Test: test_truth
---------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------
SecureApi::Test: test_truth
---------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------
SecureApi::Test: test_truth
---------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (37.5ms)[0m  [1m[35mDROP DATABASE IF EXISTS "dummy_test"[0m
  [1m[35m (155.6ms)[0m  [1m[35mCREATE DATABASE "dummy_test" ENCODING = 'unicode'[0m
  [1m[35mSQL (1.3ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (4.3ms)[0m  [1m[35mDROP TABLE IF EXISTS "secure_api_tokens" CASCADE[0m
  [1m[35m (21.6ms)[0m  [1m[35mCREATE TABLE "secure_api_tokens" ("id" bigserial primary key, "token" character varying, "exp_date" timestamp, "resource_type" character varying, "resource_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (2.3ms)[0m  [1m[35mCREATE  INDEX  "index_secure_api_tokens_on_resource" ON "secure_api_tokens"  ("resource_type", "resource_id")[0m
  [1m[35m (3.5ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (22.0ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20200121035920)[0m
  [1m[35m (6.3ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.4ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "key"[0m  [["key", "environment"], ["value", "test"], ["created_at", "2020-11-21 23:06:59.152946"], ["updated_at", "2020-11-21 23:06:59.152946"]]
  [1m[35m (6.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "key"[0m  [["key", "schema_sha1"], ["value", "e158df7efc4c7c9b5bfe8bee5cec372b93750551"], ["created_at", "2020-11-21 23:06:59.163825"], ["updated_at", "2020-11-21 23:06:59.163825"]]
  [1m[35m (31.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------
SecureApi::Test: test_truth
---------------------------
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
SecureApi::SecureApiControllerTest: test_login
----------------------------------------------
  [1m[35m (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
Started GET "/user/login" for 127.0.0.1 at 2020-11-22 00:06:59 +0100
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------
SecureApi::Test: test_truth
---------------------------
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
SecureApi::SecureApiControllerTest: test_login
----------------------------------------------
  [1m[35m (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
Started POST "/user/login" for 127.0.0.1 at 2020-11-22 00:07:38 +0100
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
SecureApi::SecureApiControllerTest: test_login
----------------------------------------------
  [1m[35m (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
Started POST "/user/login" for 127.0.0.1 at 2020-11-22 00:08:01 +0100
Processing by SecureApi::SecureApiController#login as HTML
  [1m[35m (0.9ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Create (2.0ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("created_at", "updated_at") VALUES ($1, $2) RETURNING "id"[0m  [["created_at", "2020-11-21 23:08:01.198271"], ["updated_at", "2020-11-21 23:08:01.198271"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 204 No Content in 22ms (ActiveRecord: 13.8ms | Allocations: 4215)
  [1m[35m (4.0ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
  [1m[35m (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------
SecureApi::Test: test_truth
---------------------------
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
SecureApi::SecureApiControllerTest: test_login
----------------------------------------------
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
Started POST "/user/login" for 127.0.0.1 at 2020-11-22 00:26:37 +0100
Processing by SecureApi::SecureApiController#login as HTML
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Create (0.5ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("created_at", "updated_at") VALUES ($1, $2) RETURNING "id"[0m  [["created_at", "2020-11-21 23:26:37.533830"], ["updated_at", "2020-11-21 23:26:37.533830"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 204 No Content in 22ms (ActiveRecord: 3.9ms | Allocations: 4215)
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------
SecureApi::Test: test_truth
---------------------------
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (3.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
SecureApi::SecureApiControllerTest: test_login
----------------------------------------------
  [1m[35m (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
Started POST "/user/login" for 127.0.0.1 at 2020-11-22 00:48:56 +0100
Processing by SecureApi::SecureApiController#login as HTML
Completed 422 Unprocessable Entity in 18ms (ActiveRecord: 3.1ms | Allocations: 7646)
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------
SecureApi::Test: test_truth
---------------------------
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "environment"]]
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "environment"]]
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "environment"]]
  [1m[35m (58.9ms)[0m  [1m[35mDROP DATABASE IF EXISTS "dummy_test"[0m
  [1m[35m (150.1ms)[0m  [1m[35mCREATE DATABASE "dummy_test" ENCODING = 'unicode'[0m
  [1m[35mSQL (0.5ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.3ms)[0m  [1m[35mDROP TABLE IF EXISTS "secure_api_tokens" CASCADE[0m
  [1m[35m (10.3ms)[0m  [1m[35mCREATE TABLE "secure_api_tokens" ("id" bigserial primary key, "token" character varying, "exp_date" timestamp, "resource_type" character varying, "resource_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (1.9ms)[0m  [1m[35mCREATE  INDEX  "index_secure_api_tokens_on_resource" ON "secure_api_tokens"  ("resource_type", "resource_id")[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "users" CASCADE[0m
  [1m[35m (3.0ms)[0m  [1m[35mCREATE TABLE "users" ("id" bigserial primary key, "name" character varying, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL)[0m
  [1m[35m (3.2ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20200121035920)[0m
  [1m[35m (0.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20190901182345);

[0m
  [1m[35m (3.2ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.5ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "key"[0m  [["key", "environment"], ["value", "test"], ["created_at", "2020-11-21 23:52:38.867883"], ["updated_at", "2020-11-21 23:52:38.867883"]]
  [1m[35m (3.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "key"[0m  [["key", "schema_sha1"], ["value", "46908c0ecacba60457d88129cd8994b6a4a6502f"], ["created_at", "2020-11-21 23:52:38.876348"], ["updated_at", "2020-11-21 23:52:38.876348"]]
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------
SecureApi::Test: test_truth
---------------------------
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
SecureApi::SecureApiControllerTest: test_login
----------------------------------------------
  [1m[35m (0.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
Started POST "/user/login" for 127.0.0.1 at 2020-11-22 00:52:39 +0100
Processing by SecureApi::SecureApiController#login as HTML
Completed 422 Unprocessable Entity in 21ms (ActiveRecord: 4.1ms | Allocations: 7648)
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
SecureApi::SecureApiControllerTest: test_login
----------------------------------------------
  [1m[35m (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
Started POST "/user/login" for 127.0.0.1 at 2020-11-22 00:53:16 +0100
Processing by SecureApi::SecureApiController#login as HTML
Completed 422 Unprocessable Entity in 18ms (ActiveRecord: 2.6ms | Allocations: 7649)
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------
SecureApi::Test: test_truth
---------------------------
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------
SecureApi::Test: test_truth
---------------------------
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
SecureApi::SecureApiControllerTest: test_login
----------------------------------------------
  [1m[35m (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
Started POST "/user/login" for 127.0.0.1 at 2020-11-22 00:53:45 +0100
Processing by SecureApi::SecureApiController#login as HTML
Completed 422 Unprocessable Entity in 19ms (ActiveRecord: 2.3ms | Allocations: 7648)
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
SecureApi::SecureApiControllerTest: test_login
----------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------
SecureApi::Test: test_truth
---------------------------
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
SecureApi::SecureApiControllerTest: test_login
----------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------
SecureApi::Test: test_truth
---------------------------
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
SecureApi::SecureApiControllerTest: test_login
----------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------
SecureApi::Test: test_truth
---------------------------
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------
SecureApi::Test: test_truth
---------------------------
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
SecureApi::SecureApiControllerTest: test_login
----------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------
SecureApi::Test: test_truth
---------------------------
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
SecureApi::SecureApiControllerTest: test_login
----------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
SecureApi::SecureApiControllerTest: test_login
----------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
SecureApi::SecureApiControllerTest: test_login
----------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------
SecureApi::Test: test_truth
---------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------
SecureApi::Test: test_truth
---------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
SecureApi::SecureApiControllerTest: test_login
----------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
SecureApi::TokenTest: test_is_ok_test
-------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
SecureApi::SecureApiControllerTest: test_login
----------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------
SecureApi::Test: test_truth
---------------------------
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (36.7ms)[0m  [1m[35mDROP DATABASE IF EXISTS "dummy_test"[0m
  [1m[35m (132.5ms)[0m  [1m[35mCREATE DATABASE "dummy_test" ENCODING = 'unicode'[0m
  [1m[35mSQL (0.4ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "secure_api_tokens" CASCADE[0m
  [1m[35m (8.1ms)[0m  [1m[35mCREATE TABLE "secure_api_tokens" ("id" bigserial primary key, "token" character varying, "exp_date" timestamp, "resource_type" character varying, "resource_id" bigint, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE  INDEX  "index_secure_api_tokens_on_resource" ON "secure_api_tokens"  ("resource_type", "resource_id")[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "users" CASCADE[0m
  [1m[35m (2.7ms)[0m  [1m[35mCREATE TABLE "users" ("id" bigserial primary key, "email" character varying, "password" character varying, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL)[0m
  [1m[35m (1.7ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20200121035920)[0m
  [1m[35m (0.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20190901182345);

[0m
  [1m[35m (2.6ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.5ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "key"[0m  [["key", "environment"], ["value", "test"], ["created_at", "2020-11-22 00:07:41.471187"], ["updated_at", "2020-11-22 00:07:41.471187"]]
  [1m[35m (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "schema_sha1"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "key"[0m  [["key", "schema_sha1"], ["value", "56609ab6d2cbc630767899026045ecfe49460a14"], ["created_at", "2020-11-22 00:07:41.475667"], ["updated_at", "2020-11-22 00:07:41.475667"]]
  [1m[35m (0.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
SecureApi::SecureApiControllerTest: test_login
----------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------
SecureApi::Test: test_truth
---------------------------
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
SecureApi::TokenTest: test_is_ok_test
-------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (1.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "123456"], ["created_at", "2020-11-22 00:07:41.644598"], ["updated_at", "2020-11-22 00:07:41.644598"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
SecureApi::TokenTest: test_is_expired_test
------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "123456"], ["created_at", "2020-11-22 00:07:41.687374"], ["updated_at", "2020-11-22 00:07:41.687374"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
---------------------------
SecureApi::Test: test_truth
---------------------------
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
SecureApi::SecureApiControllerTest: test_login
----------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
SecureApi::TokenTest: test_is_expired_test
------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "123456"], ["created_at", "2020-11-22 00:08:09.111372"], ["updated_at", "2020-11-22 00:08:09.111372"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.4ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjozLCJleHAiOjE2MDYxNzY0ODl9.johlP9I0b0zCl76AICAC3m8LBJpZyJgBqo-GYqteiCg"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (1.1ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjozLCJleHAiOjE2MDYxNzY0ODl9.johlP9I0b0zCl76AICAC3m8LBJpZyJgBqo-GYqteiCg"], ["exp_date", "2020-11-24 00:08:09"], ["resource_type", "User"], ["resource_id", 3], ["created_at", "2020-11-22 00:08:09.140340"], ["updated_at", "2020-11-22 00:08:09.140340"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
SecureApi::TokenTest: test_is_ok_test
-------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "123456"], ["created_at", "2020-11-22 00:08:09.145236"], ["updated_at", "2020-11-22 00:08:09.145236"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.1ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo0LCJleHAiOjE2MDYxNzY0ODl9.RV72BSOIk0BkpiSM9QPfJLxPOhAEy1OAV181I2p8WUM"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.1ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo0LCJleHAiOjE2MDYxNzY0ODl9.RV72BSOIk0BkpiSM9QPfJLxPOhAEy1OAV181I2p8WUM"], ["exp_date", "2020-11-24 00:08:09"], ["resource_type", "User"], ["resource_id", 4], ["created_at", "2020-11-22 00:08:09.146781"], ["updated_at", "2020-11-22 00:08:09.146781"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------
SecureApi::TokenTest: test_decode
---------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "123456"], ["created_at", "2020-11-22 00:09:36.693454"], ["updated_at", "2020-11-22 00:09:36.693454"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.6ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo1LCJleHAiOjE2MDYxNzY1NzZ9.x9mq9A8wWQGoJVDdmQ6vTa2XYyLq99DBScQ5fupT-pQ"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.4ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo1LCJleHAiOjE2MDYxNzY1NzZ9.x9mq9A8wWQGoJVDdmQ6vTa2XYyLq99DBScQ5fupT-pQ"], ["exp_date", "2020-11-24 00:09:36"], ["resource_type", "User"], ["resource_id", 5], ["created_at", "2020-11-22 00:09:36.737891"], ["updated_at", "2020-11-22 00:09:36.737891"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
SecureApi::TokenTest: test_is_expired
-------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "123456"], ["created_at", "2020-11-22 00:09:36.741145"], ["updated_at", "2020-11-22 00:09:36.741145"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo2LCJleHAiOjE2MDYxNzY1NzZ9.ZGGafYBegE0lG3tGdvOVa8S52j8enZ3G_nrwQYz8_Zg"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo2LCJleHAiOjE2MDYxNzY1NzZ9.ZGGafYBegE0lG3tGdvOVa8S52j8enZ3G_nrwQYz8_Zg"], ["exp_date", "2020-11-24 00:09:36"], ["resource_type", "User"], ["resource_id", 6], ["created_at", "2020-11-22 00:09:36.743023"], ["updated_at", "2020-11-22 00:09:36.743023"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------
SecureApi::TokenTest: test_is_ok
--------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "123456"], ["created_at", "2020-11-22 00:09:36.745085"], ["updated_at", "2020-11-22 00:09:36.745085"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.1ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo3LCJleHAiOjE2MDYxNzY1NzZ9._A72ts-XyYii9BM8pB9RPsQmCWJt1YE3CQEP2aGWA1Y"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo3LCJleHAiOjE2MDYxNzY1NzZ9._A72ts-XyYii9BM8pB9RPsQmCWJt1YE3CQEP2aGWA1Y"], ["exp_date", "2020-11-24 00:09:36"], ["resource_type", "User"], ["resource_id", 7], ["created_at", "2020-11-22 00:09:36.746956"], ["updated_at", "2020-11-22 00:09:36.746956"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------
SecureApi::Test: test_truth
---------------------------
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
SecureApi::SecureApiControllerTest: test_login
----------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------
SecureApi::Test: test_truth
---------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
SecureApi::SecureApiControllerTest: test_login
----------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------
SecureApi::TokenTest: test_decode
---------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "123456"], ["created_at", "2020-11-22 00:10:07.155252"], ["updated_at", "2020-11-22 00:10:07.155252"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.5ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo4LCJleHAiOjE2MDYxNzY2MDd9.Fonzv-DEzI_wMA_7yffi00mKZ_6OZYN6dU5D98NvJ00"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.5ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo4LCJleHAiOjE2MDYxNzY2MDd9.Fonzv-DEzI_wMA_7yffi00mKZ_6OZYN6dU5D98NvJ00"], ["exp_date", "2020-11-24 00:10:07"], ["resource_type", "User"], ["resource_id", 8], ["created_at", "2020-11-22 00:10:07.200910"], ["updated_at", "2020-11-22 00:10:07.200910"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------
SecureApi::TokenTest: test_is_ok
--------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "123456"], ["created_at", "2020-11-22 00:10:07.206608"], ["updated_at", "2020-11-22 00:10:07.206608"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.3ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo5LCJleHAiOjE2MDYxNzY2MDd9.M2AoMZ8TF4C2rLBxCRPc4ZYIpZbOsOe0yHjOsSy5rKE"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.3ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo5LCJleHAiOjE2MDYxNzY2MDd9.M2AoMZ8TF4C2rLBxCRPc4ZYIpZbOsOe0yHjOsSy5rKE"], ["exp_date", "2020-11-24 00:10:07"], ["resource_type", "User"], ["resource_id", 9], ["created_at", "2020-11-22 00:10:07.209801"], ["updated_at", "2020-11-22 00:10:07.209801"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
SecureApi::TokenTest: test_is_expired
-------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "123456"], ["created_at", "2020-11-22 00:10:07.214618"], ["updated_at", "2020-11-22 00:10:07.214618"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMCwiZXhwIjoxNjA2MTc2NjA3fQ.zlQpGtRABBCAEevROyMVv8eS9sPGvdM3wcLwkMbcYcw"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.4ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMCwiZXhwIjoxNjA2MTc2NjA3fQ.zlQpGtRABBCAEevROyMVv8eS9sPGvdM3wcLwkMbcYcw"], ["exp_date", "2020-11-24 00:10:07"], ["resource_type", "User"], ["resource_id", 10], ["created_at", "2020-11-22 00:10:07.217481"], ["updated_at", "2020-11-22 00:10:07.217481"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------
SecureApi::Test: test_truth
---------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
SecureApi::SecureApiControllerTest: test_login
----------------------------------------------
  [1m[35m (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
SecureApi::TokenTest: test_is_expired
-------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "123456"], ["created_at", "2020-11-22 00:10:32.027029"], ["updated_at", "2020-11-22 00:10:32.027029"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.3ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMSwiZXhwIjoxNjA2MTc2NjMyfQ.jd_6CzY2B7IdkYU_zTI3hYZ2Ak-ShKDQAHyY1JSDdyc"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.8ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMSwiZXhwIjoxNjA2MTc2NjMyfQ.jd_6CzY2B7IdkYU_zTI3hYZ2Ak-ShKDQAHyY1JSDdyc"], ["exp_date", "2020-11-24 00:10:32"], ["resource_type", "User"], ["resource_id", 11], ["created_at", "2020-11-22 00:10:32.064148"], ["updated_at", "2020-11-22 00:10:32.064148"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------
SecureApi::TokenTest: test_is_ok
--------------------------------
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.7ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "123456"], ["created_at", "2020-11-22 00:10:32.067342"], ["updated_at", "2020-11-22 00:10:32.067342"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMiwiZXhwIjoxNjA2MTc2NjMyfQ.KSViTQ8JpZ2Q-Isi_zLhBYNLDqzuFWNNvEwVEhqxOQw"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMiwiZXhwIjoxNjA2MTc2NjMyfQ.KSViTQ8JpZ2Q-Isi_zLhBYNLDqzuFWNNvEwVEhqxOQw"], ["exp_date", "2020-11-24 00:10:32"], ["resource_type", "User"], ["resource_id", 12], ["created_at", "2020-11-22 00:10:32.070134"], ["updated_at", "2020-11-22 00:10:32.070134"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------
SecureApi::TokenTest: test_decode
---------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "123456"], ["created_at", "2020-11-22 00:10:32.072332"], ["updated_at", "2020-11-22 00:10:32.072332"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.1ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMywiZXhwIjoxNjA2MTc2NjMyfQ.9xZLA7-poroir6PWokJpcCxTbZdEGFblZHDzpTo1A4U"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMywiZXhwIjoxNjA2MTc2NjMyfQ.9xZLA7-poroir6PWokJpcCxTbZdEGFblZHDzpTo1A4U"], ["exp_date", "2020-11-24 00:10:32"], ["resource_type", "User"], ["resource_id", 13], ["created_at", "2020-11-22 00:10:32.074220"], ["updated_at", "2020-11-22 00:10:32.074220"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
SecureApi::SecureApiControllerTest: test_login
----------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------
SecureApi::Test: test_truth
---------------------------
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
SecureApi::TokenTest: test_is_expired
-------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.8ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "123456"], ["created_at", "2020-11-22 00:12:29.664826"], ["updated_at", "2020-11-22 00:12:29.664826"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.4ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxNCwiZXhwIjoxNjA2MTc2NzQ5fQ.YL2e4OJpnz0Mh-jf1AFW6BfBWmullwvQgzjqipbmDv0"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.9ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxNCwiZXhwIjoxNjA2MTc2NzQ5fQ.YL2e4OJpnz0Mh-jf1AFW6BfBWmullwvQgzjqipbmDv0"], ["exp_date", "2020-11-24 00:12:29"], ["resource_type", "User"], ["resource_id", 14], ["created_at", "2020-11-22 00:12:29.701384"], ["updated_at", "2020-11-22 00:12:29.701384"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------
SecureApi::TokenTest: test_decode
---------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "123456"], ["created_at", "2020-11-22 00:12:29.705030"], ["updated_at", "2020-11-22 00:12:29.705030"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxNSwiZXhwIjoxNjA2MTc2NzQ5fQ.5h_FlN03c8JZC8__S_dOPaV8s2kvho-5yKfhYVU5Fbo"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.4ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxNSwiZXhwIjoxNjA2MTc2NzQ5fQ.5h_FlN03c8JZC8__S_dOPaV8s2kvho-5yKfhYVU5Fbo"], ["exp_date", "2020-11-24 00:12:29"], ["resource_type", "User"], ["resource_id", 15], ["created_at", "2020-11-22 00:12:29.707113"], ["updated_at", "2020-11-22 00:12:29.707113"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------
SecureApi::TokenTest: test_is_ok
--------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "123456"], ["created_at", "2020-11-22 00:12:29.709209"], ["updated_at", "2020-11-22 00:12:29.709209"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxNiwiZXhwIjoxNjA2MTc2NzQ5fQ.K5hIhcsMc9HoT6c0jFS1iIrbHjmSofvIfAvc06vCGwk"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxNiwiZXhwIjoxNjA2MTc2NzQ5fQ.K5hIhcsMc9HoT6c0jFS1iIrbHjmSofvIfAvc06vCGwk"], ["exp_date", "2020-11-24 00:12:29"], ["resource_type", "User"], ["resource_id", 16], ["created_at", "2020-11-22 00:12:29.711169"], ["updated_at", "2020-11-22 00:12:29.711169"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------
SecureApi::TokenTest: test_set_token
------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "123456"], ["created_at", "2020-11-22 00:12:29.713088"], ["updated_at", "2020-11-22 00:12:29.713088"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxNywiZXhwIjoxNjA2MTc2NzQ5fQ.4rKycpyP_3rcIggvu1T-uKKsj10LZPQCWhNzFWHGX3E"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxNywiZXhwIjoxNjA2MTc2NzQ5fQ.4rKycpyP_3rcIggvu1T-uKKsj10LZPQCWhNzFWHGX3E"], ["exp_date", "2020-11-24 00:12:29"], ["resource_type", "User"], ["resource_id", 17], ["created_at", "2020-11-22 00:12:29.714928"], ["updated_at", "2020-11-22 00:12:29.714928"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------
SecureApi::Test: test_truth
---------------------------
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------
SecureApi::TokenTest: test_is_ok
--------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "123456"], ["created_at", "2020-11-22 00:14:49.154320"], ["updated_at", "2020-11-22 00:14:49.154320"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (1.0ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxOCwiZXhwIjoxNjA2MTc2ODg5fQ.6AXVCfghumvw2P0nzMfrGkf_oh2FLsq1ZQ7v1Huidbw"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxOCwiZXhwIjoxNjA2MTc2ODg5fQ.6AXVCfghumvw2P0nzMfrGkf_oh2FLsq1ZQ7v1Huidbw"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.4ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxOCwiZXhwIjoxNjA2MTc2ODg5fQ.6AXVCfghumvw2P0nzMfrGkf_oh2FLsq1ZQ7v1Huidbw"], ["exp_date", "2020-11-24 00:14:49"], ["resource_type", "User"], ["resource_id", 18], ["created_at", "2020-11-22 00:14:49.198217"], ["updated_at", "2020-11-22 00:14:49.198217"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------
SecureApi::TokenTest: test_decode
---------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "123456"], ["created_at", "2020-11-22 00:14:49.200812"], ["updated_at", "2020-11-22 00:14:49.200812"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.3ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxOSwiZXhwIjoxNjA2MTc2ODg5fQ.8sKkhD8pZYFQhY96GgB6XxuXqJF2lwfdpRIJoJ2R3HI"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxOSwiZXhwIjoxNjA2MTc2ODg5fQ.8sKkhD8pZYFQhY96GgB6XxuXqJF2lwfdpRIJoJ2R3HI"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxOSwiZXhwIjoxNjA2MTc2ODg5fQ.8sKkhD8pZYFQhY96GgB6XxuXqJF2lwfdpRIJoJ2R3HI"], ["exp_date", "2020-11-24 00:14:49"], ["resource_type", "User"], ["resource_id", 19], ["created_at", "2020-11-22 00:14:49.204033"], ["updated_at", "2020-11-22 00:14:49.204033"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------
SecureApi::TokenTest: test_set_token
------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "123456"], ["created_at", "2020-11-22 00:14:49.205940"], ["updated_at", "2020-11-22 00:14:49.205940"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.1ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoyMCwiZXhwIjoxNjA2MTc2ODg5fQ.kcEn364l_IOCqs6ki8RpSos_0VTTZzcKfUcySddRTlQ"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoyMCwiZXhwIjoxNjA2MTc2ODg5fQ.kcEn364l_IOCqs6ki8RpSos_0VTTZzcKfUcySddRTlQ"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoyMCwiZXhwIjoxNjA2MTc2ODg5fQ.kcEn364l_IOCqs6ki8RpSos_0VTTZzcKfUcySddRTlQ"], ["exp_date", "2020-11-24 00:14:49"], ["resource_type", "User"], ["resource_id", 20], ["created_at", "2020-11-22 00:14:49.208007"], ["updated_at", "2020-11-22 00:14:49.208007"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
SecureApi::TokenTest: test_is_expired
-------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "123456"], ["created_at", "2020-11-22 00:14:49.209576"], ["updated_at", "2020-11-22 00:14:49.209576"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoyMSwiZXhwIjoxNjA2MTc2ODg5fQ.CBFWda9oh8ZWNFqyP49ZJwLYOqrJAOCO2tYfyjvtbt4"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoyMSwiZXhwIjoxNjA2MTc2ODg5fQ.CBFWda9oh8ZWNFqyP49ZJwLYOqrJAOCO2tYfyjvtbt4"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoyMSwiZXhwIjoxNjA2MTc2ODg5fQ.CBFWda9oh8ZWNFqyP49ZJwLYOqrJAOCO2tYfyjvtbt4"], ["exp_date", "2020-11-24 00:14:49"], ["resource_type", "User"], ["resource_id", 21], ["created_at", "2020-11-22 00:14:49.211700"], ["updated_at", "2020-11-22 00:14:49.211700"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
SecureApi::SecureApiControllerTest: test_login
----------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
SecureApi::SecureApiControllerTest: test_login
----------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "123456"], ["created_at", "2020-11-22 00:35:10.786198"], ["updated_at", "2020-11-22 00:35:10.786198"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/user/login" for 127.0.0.1 at 2020-11-22 01:35:10 +0100
Processing by SecureApi::SecureApiController#login as HTML
  Parameters: {"email"=>"name@example.com", "password"=>"[FILTERED]"}
Completed 500 Internal Server Error in 1ms (ActiveRecord: 0.0ms | Allocations: 668)
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
SecureApi::SecureApiControllerTest: test_logout
-----------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "123456"], ["created_at", "2020-11-22 00:35:10.869715"], ["updated_at", "2020-11-22 00:35:10.869715"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
SecureApi::SecureApiControllerTest: test_check_token
----------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "123456"], ["created_at", "2020-11-22 00:35:10.871501"], ["updated_at", "2020-11-22 00:35:10.871501"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------
SecureApi::Test: test_truth
---------------------------
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------
SecureApi::TokenTest: test_is_ok
--------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "123456"], ["created_at", "2020-11-22 00:35:10.873691"], ["updated_at", "2020-11-22 00:35:10.873691"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.4ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoyNSwiZXhwIjoxNjA2MTc4MTEwfQ.N_hrYsUD-rSbGD8Aj0ICBiR0yqFyGnO76box8_iD_to"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoyNSwiZXhwIjoxNjA2MTc4MTEwfQ.N_hrYsUD-rSbGD8Aj0ICBiR0yqFyGnO76box8_iD_to"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.8ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoyNSwiZXhwIjoxNjA2MTc4MTEwfQ.N_hrYsUD-rSbGD8Aj0ICBiR0yqFyGnO76box8_iD_to"], ["exp_date", "2020-11-24 00:35:10"], ["resource_type", "User"], ["resource_id", 25], ["created_at", "2020-11-22 00:35:10.908939"], ["updated_at", "2020-11-22 00:35:10.908939"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------
SecureApi::TokenTest: test_set_token
------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "123456"], ["created_at", "2020-11-22 00:35:10.913140"], ["updated_at", "2020-11-22 00:35:10.913140"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.4ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoyNiwiZXhwIjoxNjA2MTc4MTEwfQ.wx-KLTvwApzibgjYfqowrc2CUMb1vtftWshBlRyXgNg"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoyNiwiZXhwIjoxNjA2MTc4MTEwfQ.wx-KLTvwApzibgjYfqowrc2CUMb1vtftWshBlRyXgNg"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoyNiwiZXhwIjoxNjA2MTc4MTEwfQ.wx-KLTvwApzibgjYfqowrc2CUMb1vtftWshBlRyXgNg"], ["exp_date", "2020-11-24 00:35:10"], ["resource_type", "User"], ["resource_id", 26], ["created_at", "2020-11-22 00:35:10.916361"], ["updated_at", "2020-11-22 00:35:10.916361"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
SecureApi::TokenTest: test_is_expired
-------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "123456"], ["created_at", "2020-11-22 00:35:10.918113"], ["updated_at", "2020-11-22 00:35:10.918113"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.1ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoyNywiZXhwIjoxNjA2MTc4MTEwfQ.DvyC22p-ZBc5eoejA7LOL6gNS_Ru0goDHk2yF3kItLU"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoyNywiZXhwIjoxNjA2MTc4MTEwfQ.DvyC22p-ZBc5eoejA7LOL6gNS_Ru0goDHk2yF3kItLU"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoyNywiZXhwIjoxNjA2MTc4MTEwfQ.DvyC22p-ZBc5eoejA7LOL6gNS_Ru0goDHk2yF3kItLU"], ["exp_date", "2020-11-24 00:35:10"], ["resource_type", "User"], ["resource_id", 27], ["created_at", "2020-11-22 00:35:10.920173"], ["updated_at", "2020-11-22 00:35:10.920173"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------
SecureApi::TokenTest: test_decode
---------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "123456"], ["created_at", "2020-11-22 00:35:10.922096"], ["updated_at", "2020-11-22 00:35:10.922096"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.3ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoyOCwiZXhwIjoxNjA2MTc4MTEwfQ.LWY3jTSAHbNUlqZ3YBFMsW293kKNIkAOw_sBbbzhTLQ"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoyOCwiZXhwIjoxNjA2MTc4MTEwfQ.LWY3jTSAHbNUlqZ3YBFMsW293kKNIkAOw_sBbbzhTLQ"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoyOCwiZXhwIjoxNjA2MTc4MTEwfQ.LWY3jTSAHbNUlqZ3YBFMsW293kKNIkAOw_sBbbzhTLQ"], ["exp_date", "2020-11-24 00:35:10"], ["resource_type", "User"], ["resource_id", 28], ["created_at", "2020-11-22 00:35:10.924848"], ["updated_at", "2020-11-22 00:35:10.924848"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------
SecureApi::Test: test_truth
---------------------------
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------
SecureApi::TokenTest: test_set_token
------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "123456"], ["created_at", "2020-11-22 00:35:40.400528"], ["updated_at", "2020-11-22 00:35:40.400528"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.3ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoyOSwiZXhwIjoxNjA2MTc4MTQwfQ.LiDrFvChW3NKqNlIHAqoV9R1NnjYWA042u8hf0Nkhos"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoyOSwiZXhwIjoxNjA2MTc4MTQwfQ.LiDrFvChW3NKqNlIHAqoV9R1NnjYWA042u8hf0Nkhos"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.4ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoyOSwiZXhwIjoxNjA2MTc4MTQwfQ.LiDrFvChW3NKqNlIHAqoV9R1NnjYWA042u8hf0Nkhos"], ["exp_date", "2020-11-24 00:35:40"], ["resource_type", "User"], ["resource_id", 29], ["created_at", "2020-11-22 00:35:40.454902"], ["updated_at", "2020-11-22 00:35:40.454902"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
SecureApi::TokenTest: test_is_expired
-------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "123456"], ["created_at", "2020-11-22 00:35:40.457171"], ["updated_at", "2020-11-22 00:35:40.457171"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjozMCwiZXhwIjoxNjA2MTc4MTQwfQ.-avvTkbzONH09pX60ODEj9gs3QS1IcwB3pCGnEgTLAg"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjozMCwiZXhwIjoxNjA2MTc4MTQwfQ.-avvTkbzONH09pX60ODEj9gs3QS1IcwB3pCGnEgTLAg"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjozMCwiZXhwIjoxNjA2MTc4MTQwfQ.-avvTkbzONH09pX60ODEj9gs3QS1IcwB3pCGnEgTLAg"], ["exp_date", "2020-11-24 00:35:40"], ["resource_type", "User"], ["resource_id", 30], ["created_at", "2020-11-22 00:35:40.459682"], ["updated_at", "2020-11-22 00:35:40.459682"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------
SecureApi::TokenTest: test_is_ok
--------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "123456"], ["created_at", "2020-11-22 00:35:40.461764"], ["updated_at", "2020-11-22 00:35:40.461764"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjozMSwiZXhwIjoxNjA2MTc4MTQwfQ.EEx0mGc5MbTtqveXKauAJczEbTwbKA017kUweK4iTWA"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjozMSwiZXhwIjoxNjA2MTc4MTQwfQ.EEx0mGc5MbTtqveXKauAJczEbTwbKA017kUweK4iTWA"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjozMSwiZXhwIjoxNjA2MTc4MTQwfQ.EEx0mGc5MbTtqveXKauAJczEbTwbKA017kUweK4iTWA"], ["exp_date", "2020-11-24 00:35:40"], ["resource_type", "User"], ["resource_id", 31], ["created_at", "2020-11-22 00:35:40.464116"], ["updated_at", "2020-11-22 00:35:40.464116"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------
SecureApi::TokenTest: test_decode
---------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "123456"], ["created_at", "2020-11-22 00:35:40.466081"], ["updated_at", "2020-11-22 00:35:40.466081"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.1ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjozMiwiZXhwIjoxNjA2MTc4MTQwfQ.TzO5o5DQABtJxumxPPjRaYBuWZ24yVF_fRj5A3TBtqI"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjozMiwiZXhwIjoxNjA2MTc4MTQwfQ.TzO5o5DQABtJxumxPPjRaYBuWZ24yVF_fRj5A3TBtqI"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjozMiwiZXhwIjoxNjA2MTc4MTQwfQ.TzO5o5DQABtJxumxPPjRaYBuWZ24yVF_fRj5A3TBtqI"], ["exp_date", "2020-11-24 00:35:40"], ["resource_type", "User"], ["resource_id", 32], ["created_at", "2020-11-22 00:35:40.468377"], ["updated_at", "2020-11-22 00:35:40.468377"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
SecureApi::SecureApiControllerTest: test_login
----------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "123456"], ["created_at", "2020-11-22 00:35:40.508650"], ["updated_at", "2020-11-22 00:35:40.508650"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/user/login" for 127.0.0.1 at 2020-11-22 01:35:40 +0100
Processing by SecureApi::SecureApiController#login as HTML
  Parameters: {"email"=>"name@example.com", "password"=>"[FILTERED]"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "name@example.com"], ["LIMIT", 1]]
Completed 500 Internal Server Error in 64ms (ActiveRecord: 0.3ms | Allocations: 1081)
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
SecureApi::SecureApiControllerTest: test_logout
-----------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "123456"], ["created_at", "2020-11-22 00:35:40.664827"], ["updated_at", "2020-11-22 00:35:40.664827"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
SecureApi::SecureApiControllerTest: test_check_token
----------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "123456"], ["created_at", "2020-11-22 00:35:40.667052"], ["updated_at", "2020-11-22 00:35:40.667052"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (1.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
SecureApi::SecureApiControllerTest: test_login
----------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (3.8ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "faed5f6a2085e574afdc8b1cbfdfe5046ce60a5dc04b0b58a2fe0c578ad338a6$$2Xt4eY+qFEEbRSm9jmoY3g==--dk5+PpR/JP9Cd/hi--mpTIReHqOcqftsaMZjtqCg=="], ["created_at", "2020-11-22 00:41:59.123626"], ["updated_at", "2020-11-22 00:41:59.123626"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/user/login" for 127.0.0.1 at 2020-11-22 01:41:59 +0100
Processing by SecureApi::SecureApiController#login as HTML
  Parameters: {"email"=>"name@example.com", "password"=>"[FILTERED]"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "name@example.com"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Load (0.5ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."resource_id" = $1 AND "secure_api_tokens"."resource_type" = $2 LIMIT $3[0m  [["resource_id", 36], ["resource_type", "User"], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjozNiwiZXhwIjoxNjA2MTc4NTE5fQ.Kd-qLNy4he6KzKygMFk_Qg6CJ5BDRI04G05BJvl_T9k"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjozNiwiZXhwIjoxNjA2MTc4NTE5fQ.Kd-qLNy4he6KzKygMFk_Qg6CJ5BDRI04G05BJvl_T9k"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.3ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjozNiwiZXhwIjoxNjA2MTc4NTE5fQ.Kd-qLNy4he6KzKygMFk_Qg6CJ5BDRI04G05BJvl_T9k"], ["exp_date", "2020-11-24 00:41:59"], ["resource_type", "User"], ["resource_id", 36], ["created_at", "2020-11-22 00:41:59.240665"], ["updated_at", "2020-11-22 00:41:59.240665"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 36], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."resource_id" = $1 AND "secure_api_tokens"."resource_type" = $2 LIMIT $3[0m  [["resource_id", 36], ["resource_type", "User"], ["LIMIT", 1]]
Completed 200 OK in 95ms (Views: 0.2ms | ActiveRecord: 4.6ms | Allocations: 12822)
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
SecureApi::SecureApiControllerTest: test_logout
-----------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "a58c67c7d7cf70bd3b2f6f80fbe2bb4f4965dfc09e0a5e7b0c0dcf2da72b41c8$$txu4C7N5NwJsN+iKyXj9Yw==--qaJKIc/zbkHfxFCK--rHe5EFcGhUPEnDIQGPwH8Q=="], ["created_at", "2020-11-22 00:41:59.298635"], ["updated_at", "2020-11-22 00:41:59.298635"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
SecureApi::SecureApiControllerTest: test_check_token
----------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "94cd59b65fb4b3300546e8168e1949a72cf48c356474a679621afa277e044043$$JdL96ZeAfWbN2r64Vbh6sg==--eELI2Dum5W8lTGGX--tLEXbwLWFaoWH+a50d4Wzg=="], ["created_at", "2020-11-22 00:41:59.346627"], ["updated_at", "2020-11-22 00:41:59.346627"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------
SecureApi::Test: test_truth
---------------------------
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------
SecureApi::TokenTest: test_is_ok
--------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "958534b1d3ca7c71f2a75cb24640073bc10724e182a1b8c72cd989e5dfb79fb5$$berkq/OH6c+xCaSNcdBBiQ==--oftbeqn6sOkZmaXy--uhhpeYI6JPvRI50YKgA3hg=="], ["created_at", "2020-11-22 00:41:59.395592"], ["updated_at", "2020-11-22 00:41:59.395592"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjozOSwiZXhwIjoxNjA2MTc4NTE5fQ.pTtbV0VFKxASoAYQvCxB7qwZ2fevSwgPIsWrJCfR-2c"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjozOSwiZXhwIjoxNjA2MTc4NTE5fQ.pTtbV0VFKxASoAYQvCxB7qwZ2fevSwgPIsWrJCfR-2c"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjozOSwiZXhwIjoxNjA2MTc4NTE5fQ.pTtbV0VFKxASoAYQvCxB7qwZ2fevSwgPIsWrJCfR-2c"], ["exp_date", "2020-11-24 00:41:59"], ["resource_type", "User"], ["resource_id", 39], ["created_at", "2020-11-22 00:41:59.398554"], ["updated_at", "2020-11-22 00:41:59.398554"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------
SecureApi::TokenTest: test_set_token
------------------------------------
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "96f2e1be7e2ce8b2fe73d9e84e7c4fa3768ced6c8935b1548c3e129db57bfa3f$$SvZlhuh7RyeGUJCO8WeoyA==--IrDp0RLlN6mw35VR--6Rn0bcuRDQPrKF8G8gyjfQ=="], ["created_at", "2020-11-22 00:41:59.446582"], ["updated_at", "2020-11-22 00:41:59.446582"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo0MCwiZXhwIjoxNjA2MTc4NTE5fQ.s0M_V4958Iba5PcP4hqDhr0yFQF1ApuUPlif_e836ho"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo0MCwiZXhwIjoxNjA2MTc4NTE5fQ.s0M_V4958Iba5PcP4hqDhr0yFQF1ApuUPlif_e836ho"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.3ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo0MCwiZXhwIjoxNjA2MTc4NTE5fQ.s0M_V4958Iba5PcP4hqDhr0yFQF1ApuUPlif_e836ho"], ["exp_date", "2020-11-24 00:41:59"], ["resource_type", "User"], ["resource_id", 40], ["created_at", "2020-11-22 00:41:59.450574"], ["updated_at", "2020-11-22 00:41:59.450574"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------
SecureApi::TokenTest: test_decode
---------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "047afb855d596e810f34364dfabc07906818a2ea14b107852bdef5733c3f4e7a$$Wsk6zIPQdex9akfghWclow==--EcbL8ILzYloLzlw7--GgunoyXZV5PYIKRB3+XJhQ=="], ["created_at", "2020-11-22 00:41:59.503267"], ["updated_at", "2020-11-22 00:41:59.503267"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.3ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo0MSwiZXhwIjoxNjA2MTc4NTE5fQ.zyKpcqlRcQrxzlrskcUYEa6-Vtz3_pTOlodIYBCIMqg"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo0MSwiZXhwIjoxNjA2MTc4NTE5fQ.zyKpcqlRcQrxzlrskcUYEa6-Vtz3_pTOlodIYBCIMqg"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.4ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo0MSwiZXhwIjoxNjA2MTc4NTE5fQ.zyKpcqlRcQrxzlrskcUYEa6-Vtz3_pTOlodIYBCIMqg"], ["exp_date", "2020-11-24 00:41:59"], ["resource_type", "User"], ["resource_id", 41], ["created_at", "2020-11-22 00:41:59.506919"], ["updated_at", "2020-11-22 00:41:59.506919"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
SecureApi::TokenTest: test_is_expired
-------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "466c5390bd4726399533d56573fca6eb77576fe4100150d03f15e5b05084a9c2$$gdFb89IEahNTVPHIyxnuMQ==--uaa9++TBufUriwxo--KCBQjQOb9Es//DPokfndcA=="], ["created_at", "2020-11-22 00:41:59.554725"], ["updated_at", "2020-11-22 00:41:59.554725"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo0MiwiZXhwIjoxNjA2MTc4NTE5fQ.8FJwcOjPqAu-r6ddIGbHGsAbD0W5gGh6AImcriyAMFk"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo0MiwiZXhwIjoxNjA2MTc4NTE5fQ.8FJwcOjPqAu-r6ddIGbHGsAbD0W5gGh6AImcriyAMFk"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.4ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo0MiwiZXhwIjoxNjA2MTc4NTE5fQ.8FJwcOjPqAu-r6ddIGbHGsAbD0W5gGh6AImcriyAMFk"], ["exp_date", "2020-11-24 00:41:59"], ["resource_type", "User"], ["resource_id", 42], ["created_at", "2020-11-22 00:41:59.558254"], ["updated_at", "2020-11-22 00:41:59.558254"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------
SecureApi::TokenTest: test_is_ok
--------------------------------
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (1.0ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "e2ed17307f7622032447f08382da5e000d0d0e404d74b0b2ef9e227d83c797e9$$pCkBe3uYXppldvXDaet3vg==--6PsZybUX2AnStywO--T/YmUOMf34u6v/Lgj4loUg=="], ["created_at", "2020-11-22 00:43:20.413009"], ["updated_at", "2020-11-22 00:43:20.413009"]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.3ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo0MywiZXhwIjoxNjA2MTc4NjAwfQ.ujZZOmMXJiB4lQzk4rwqAb9lKaX6CsYSkGZKAE7W71Q"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo0MywiZXhwIjoxNjA2MTc4NjAwfQ.ujZZOmMXJiB4lQzk4rwqAb9lKaX6CsYSkGZKAE7W71Q"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.3ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo0MywiZXhwIjoxNjA2MTc4NjAwfQ.ujZZOmMXJiB4lQzk4rwqAb9lKaX6CsYSkGZKAE7W71Q"], ["exp_date", "2020-11-24 00:43:20"], ["resource_type", "User"], ["resource_id", 43], ["created_at", "2020-11-22 00:43:20.448784"], ["updated_at", "2020-11-22 00:43:20.448784"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
SecureApi::TokenTest: test_is_expired
-------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "598416880121d6510409f6e1cfb228a6992c8e3033a919823846f0e39dc399c9$$q520SxfVbhh86FOOVWDOvw==--DaGKIhul+ocfVTCh--uSwyHARcYONsXgMHwERaog=="], ["created_at", "2020-11-22 00:43:20.496846"], ["updated_at", "2020-11-22 00:43:20.496846"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo0NCwiZXhwIjoxNjA2MTc4NjAwfQ.-l2xzPI6HGkQigB54KNW2UXNnoI_Kj24Ipz9sbnk1HA"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo0NCwiZXhwIjoxNjA2MTc4NjAwfQ.-l2xzPI6HGkQigB54KNW2UXNnoI_Kj24Ipz9sbnk1HA"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.3ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo0NCwiZXhwIjoxNjA2MTc4NjAwfQ.-l2xzPI6HGkQigB54KNW2UXNnoI_Kj24Ipz9sbnk1HA"], ["exp_date", "2020-11-24 00:43:20"], ["resource_type", "User"], ["resource_id", 44], ["created_at", "2020-11-22 00:43:20.499761"], ["updated_at", "2020-11-22 00:43:20.499761"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------
SecureApi::TokenTest: test_set_token
------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "36e8343cbd67527982663ce0408cb06c631e5ccdcdac1c605811fb5c76b6cc0d$$Q68oOTU810XHjD2FfE0kKg==--ry2I0bPn/CcH8/g6--qNSUj5GtPUYW24cLJPRD7w=="], ["created_at", "2020-11-22 00:43:20.546694"], ["updated_at", "2020-11-22 00:43:20.546694"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo0NSwiZXhwIjoxNjA2MTc4NjAwfQ.CDVXGSNjxN8ZUa-_UkiqNJA6acv94tFokKVETz9n4T8"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo0NSwiZXhwIjoxNjA2MTc4NjAwfQ.CDVXGSNjxN8ZUa-_UkiqNJA6acv94tFokKVETz9n4T8"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo0NSwiZXhwIjoxNjA2MTc4NjAwfQ.CDVXGSNjxN8ZUa-_UkiqNJA6acv94tFokKVETz9n4T8"], ["exp_date", "2020-11-24 00:43:20"], ["resource_type", "User"], ["resource_id", 45], ["created_at", "2020-11-22 00:43:20.550269"], ["updated_at", "2020-11-22 00:43:20.550269"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------
SecureApi::TokenTest: test_decode
---------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "ce7178e1fe26164a4f9eab8e7ea611c7fbd2d7666f6c6f0e7c232c33c9c08a88$$QwdkmteLvTqKFTPknnR/wg==--6XaNB0FfMSy/OFlJ--z2fwnbB4caLSOK2WpZYF1w=="], ["created_at", "2020-11-22 00:43:20.598611"], ["updated_at", "2020-11-22 00:43:20.598611"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo0NiwiZXhwIjoxNjA2MTc4NjAwfQ.qALw-VUTjd9PWuK3e_sFqcdNNZBhKpHJ26Gb8lEOdII"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo0NiwiZXhwIjoxNjA2MTc4NjAwfQ.qALw-VUTjd9PWuK3e_sFqcdNNZBhKpHJ26Gb8lEOdII"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo0NiwiZXhwIjoxNjA2MTc4NjAwfQ.qALw-VUTjd9PWuK3e_sFqcdNNZBhKpHJ26Gb8lEOdII"], ["exp_date", "2020-11-24 00:43:20"], ["resource_type", "User"], ["resource_id", 46], ["created_at", "2020-11-22 00:43:20.601983"], ["updated_at", "2020-11-22 00:43:20.601983"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------
SecureApi::Test: test_truth
---------------------------
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
SecureApi::SecureApiControllerTest: test_logout
-----------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "94a91304a1cd287fd12d965f1a8418c2839ef28f1b2a327c55b5d9fc8e67660e$$wSzPL718LX2SwzAVK5Kr6A==--GEhOur3qmggp6L+4--FD3koE+OazQeb7dTzJfedg=="], ["created_at", "2020-11-22 00:43:20.671163"], ["updated_at", "2020-11-22 00:43:20.671163"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
SecureApi::SecureApiControllerTest: test_check_token
----------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "7ab18dce672fc9b04db5cb51a73408794848594deabe82ec0600d13b7d1c27b4$$t0XuniGcAvbgikROryt6JA==--V/QIpIvOyL5N9SEb--7bkKy1kBUCZ2SYerhwC7lg=="], ["created_at", "2020-11-22 00:43:20.721630"], ["updated_at", "2020-11-22 00:43:20.721630"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
SecureApi::SecureApiControllerTest: test_login
----------------------------------------------
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "4452154c2fced1ba5a87a0f935766c212fafe34f8be7bb708e2b768d0edbdfd7$$AaALhhfMQ7vb9Id6HuvfNg==--m+7/OM2KcbJ3G+lT--7yycGtoRuM1akgSCGQ6IoA=="], ["created_at", "2020-11-22 00:43:20.769870"], ["updated_at", "2020-11-22 00:43:20.769870"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/user/login" for 127.0.0.1 at 2020-11-22 01:43:20 +0100
Processing by SecureApi::SecureApiController#login as HTML
  Parameters: {"email"=>"name@example.com", "password"=>"[FILTERED]"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "name@example.com"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."resource_id" = $1 AND "secure_api_tokens"."resource_type" = $2 LIMIT $3[0m  [["resource_id", 49], ["resource_type", "User"], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo0OSwiZXhwIjoxNjA2MTc4NjAwfQ.qyYZmDtYw4RO0-wwzHc-l69z9wfY_qX05o8K3EiM81o"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo0OSwiZXhwIjoxNjA2MTc4NjAwfQ.qyYZmDtYw4RO0-wwzHc-l69z9wfY_qX05o8K3EiM81o"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo0OSwiZXhwIjoxNjA2MTc4NjAwfQ.qyYZmDtYw4RO0-wwzHc-l69z9wfY_qX05o8K3EiM81o"], ["exp_date", "2020-11-24 00:43:20"], ["resource_type", "User"], ["resource_id", 49], ["created_at", "2020-11-22 00:43:20.846800"], ["updated_at", "2020-11-22 00:43:20.846800"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 49], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."resource_id" = $1 AND "secure_api_tokens"."resource_type" = $2 LIMIT $3[0m  [["resource_id", 49], ["resource_type", "User"], ["LIMIT", 1]]
Completed 200 OK in 57ms (Views: 0.2ms | ActiveRecord: 1.5ms | Allocations: 3403)
Started POST "/user/login" for 127.0.0.1 at 2020-11-22 01:43:20 +0100
Processing by SecureApi::SecureApiController#login as HTML
  Parameters: {"email"=>"name@example.com"}
Completed 401 Unauthorized in 0ms (Views: 0.1ms | ActiveRecord: 0.0ms | Allocations: 139)
  [1m[35m (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
SecureApi::TokenTest: test_is_expired
-------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "6b3e19dc62b58224a5c534dac1fcee0da2db80bfe01eaaee82d91f6917f61f37$$LKm4VEvMoAZfCZSYmiRYyQ==--m3qsJ4UvdDFK9k9R--6opesFDC0dRFORGByLl5mQ=="], ["created_at", "2020-11-22 00:43:48.548038"], ["updated_at", "2020-11-22 00:43:48.548038"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.3ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo1MCwiZXhwIjoxNjA2MTc4NjI4fQ.brC_JW93M2Fn2nbzT0KZL9B8Gw5fQkjQlIAseE7kwwM"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo1MCwiZXhwIjoxNjA2MTc4NjI4fQ.brC_JW93M2Fn2nbzT0KZL9B8Gw5fQkjQlIAseE7kwwM"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.3ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo1MCwiZXhwIjoxNjA2MTc4NjI4fQ.brC_JW93M2Fn2nbzT0KZL9B8Gw5fQkjQlIAseE7kwwM"], ["exp_date", "2020-11-24 00:43:48"], ["resource_type", "User"], ["resource_id", 50], ["created_at", "2020-11-22 00:43:48.590551"], ["updated_at", "2020-11-22 00:43:48.590551"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------
SecureApi::TokenTest: test_set_token
------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "1990fae46871fe832620001a67bcd107cca9386ffe7934235855bc0a04ba5ae1$$vKTVzzqpKBOozpHQlS6luQ==--q6cdPmcfl1RUpvbL--U6LCVRTeBsrogCOTtx6bBw=="], ["created_at", "2020-11-22 00:43:48.640717"], ["updated_at", "2020-11-22 00:43:48.640717"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo1MSwiZXhwIjoxNjA2MTc4NjI4fQ.bwKuGvLEbry2Sxvmtxg-s2i772P-B_80wWn6W1q8aT0"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo1MSwiZXhwIjoxNjA2MTc4NjI4fQ.bwKuGvLEbry2Sxvmtxg-s2i772P-B_80wWn6W1q8aT0"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo1MSwiZXhwIjoxNjA2MTc4NjI4fQ.bwKuGvLEbry2Sxvmtxg-s2i772P-B_80wWn6W1q8aT0"], ["exp_date", "2020-11-24 00:43:48"], ["resource_type", "User"], ["resource_id", 51], ["created_at", "2020-11-22 00:43:48.643823"], ["updated_at", "2020-11-22 00:43:48.643823"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------
SecureApi::TokenTest: test_decode
---------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "19d5967b03077403a48d0a787b274fef3fcc0b8cf8bdc0ea6e3d995ee3cd6568$$YnX8nLAN45ZV+Epp2ltBaw==--aDjfkhjnENQW1/C6--IAkjDsmKugS2NVhAEH1vOw=="], ["created_at", "2020-11-22 00:43:48.694152"], ["updated_at", "2020-11-22 00:43:48.694152"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo1MiwiZXhwIjoxNjA2MTc4NjI4fQ.DxG-4XrdWA60Cecllpr9WBYz6Ixvmuw_2NAMVBKwMgU"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo1MiwiZXhwIjoxNjA2MTc4NjI4fQ.DxG-4XrdWA60Cecllpr9WBYz6Ixvmuw_2NAMVBKwMgU"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo1MiwiZXhwIjoxNjA2MTc4NjI4fQ.DxG-4XrdWA60Cecllpr9WBYz6Ixvmuw_2NAMVBKwMgU"], ["exp_date", "2020-11-24 00:43:48"], ["resource_type", "User"], ["resource_id", 52], ["created_at", "2020-11-22 00:43:48.697054"], ["updated_at", "2020-11-22 00:43:48.697054"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------
SecureApi::TokenTest: test_is_ok
--------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.8ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "db2f88fdd67328aac09346e8d3202b6b568a8bade39f84e8dbdd55d7b3d22b22$$/rFnY5VM17K69JA6RAq+ag==--4zgNRc6cTwO9lKcb--wfOdNs2BnubLb0vktwm95A=="], ["created_at", "2020-11-22 00:43:48.744623"], ["updated_at", "2020-11-22 00:43:48.744623"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.1ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo1MywiZXhwIjoxNjA2MTc4NjI4fQ.R5MAwVZZlZ2Ov9YRI7Py8oSCMd_efmxxDCl54pRiixE"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo1MywiZXhwIjoxNjA2MTc4NjI4fQ.R5MAwVZZlZ2Ov9YRI7Py8oSCMd_efmxxDCl54pRiixE"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.3ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo1MywiZXhwIjoxNjA2MTc4NjI4fQ.R5MAwVZZlZ2Ov9YRI7Py8oSCMd_efmxxDCl54pRiixE"], ["exp_date", "2020-11-24 00:43:48"], ["resource_type", "User"], ["resource_id", 53], ["created_at", "2020-11-22 00:43:48.747748"], ["updated_at", "2020-11-22 00:43:48.747748"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------
SecureApi::Test: test_truth
---------------------------
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
SecureApi::SecureApiControllerTest: test_check_token
----------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "8fdfd9a67c63f6b5e50862d9f07e15ae3559bb4e200f78164091a209102d9249$$Q2K6rrQ29sD0MytSEs5a9w==--anfo1ZaeE36G7Tpz--F8+HH8R5CVp4j1NPMsL1Bw=="], ["created_at", "2020-11-22 00:43:48.817922"], ["updated_at", "2020-11-22 00:43:48.817922"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
SecureApi::SecureApiControllerTest: test_login
----------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "c88311f048c2b75ec5d9a7ece4cde87a5ca6f848753cd56e366d7aacf1bc5935$$S7WNORqK5ZmafmYIwv4UpA==--hMYH8WHVLWEWkerL--HStsxQZy2duLiPa61a4y9g=="], ["created_at", "2020-11-22 00:43:48.869097"], ["updated_at", "2020-11-22 00:43:48.869097"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/user/login" for 127.0.0.1 at 2020-11-22 01:43:48 +0100
Processing by SecureApi::SecureApiController#login as HTML
  Parameters: {"email"=>"name@example.com", "password"=>"[FILTERED]"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "name@example.com"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."resource_id" = $1 AND "secure_api_tokens"."resource_type" = $2 LIMIT $3[0m  [["resource_id", 55], ["resource_type", "User"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.1ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo1NSwiZXhwIjoxNjA2MTc4NjI4fQ.BtI19h39HszqGN77ahoW_rATDHuIPxnXW7sBlSXRauY"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo1NSwiZXhwIjoxNjA2MTc4NjI4fQ.BtI19h39HszqGN77ahoW_rATDHuIPxnXW7sBlSXRauY"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo1NSwiZXhwIjoxNjA2MTc4NjI4fQ.BtI19h39HszqGN77ahoW_rATDHuIPxnXW7sBlSXRauY"], ["exp_date", "2020-11-24 00:43:48"], ["resource_type", "User"], ["resource_id", 55], ["created_at", "2020-11-22 00:43:48.946412"], ["updated_at", "2020-11-22 00:43:48.946412"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 55], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."resource_id" = $1 AND "secure_api_tokens"."resource_type" = $2 LIMIT $3[0m  [["resource_id", 55], ["resource_type", "User"], ["LIMIT", 1]]
Completed 200 OK in 58ms (Views: 0.2ms | ActiveRecord: 1.5ms | Allocations: 3403)
Started POST "/user/login" for 127.0.0.1 at 2020-11-22 01:43:48 +0100
Processing by SecureApi::SecureApiController#login as HTML
  Parameters: {"email"=>"name@example.com"}
Completed 401 Unauthorized in 0ms (Views: 0.1ms | ActiveRecord: 0.0ms | Allocations: 139)
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
SecureApi::SecureApiControllerTest: test_logout
-----------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "20b4d810a25adfe0f0ca79011d0d08089a2abe43a4feb90793836ee3c5127b07$$bhONxokGOCGulF6dc6+ZtA==--SEWpYaV0a4iKsfb2--0m3H3QXGGnzk9jmPRlbHTw=="], ["created_at", "2020-11-22 00:43:49.006587"], ["updated_at", "2020-11-22 00:43:49.006587"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (1.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------
SecureApi::TokenTest: test_is_ok
--------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.9ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "2cd236d73892b5d4c4321ec59dff69cb059f50af692cbbec331e191d59e85db2$$WbnIxufne1XgPM8+j0Z79A==--d6ESssUpCOsfr1vd--A7kX+J4CzQoLhAlqE4o+yg=="], ["created_at", "2020-11-22 00:47:33.096126"], ["updated_at", "2020-11-22 00:47:33.096126"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.3ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo1NywiZXhwIjoxNjA2MTc4ODUzfQ._HZawtPbG7ufE-0T77gyfsfJhQj_Ee5ugjiJlmPKbhc"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo1NywiZXhwIjoxNjA2MTc4ODUzfQ._HZawtPbG7ufE-0T77gyfsfJhQj_Ee5ugjiJlmPKbhc"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (2.4ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo1NywiZXhwIjoxNjA2MTc4ODUzfQ._HZawtPbG7ufE-0T77gyfsfJhQj_Ee5ugjiJlmPKbhc"], ["exp_date", "2020-11-24 00:47:33"], ["resource_type", "User"], ["resource_id", 57], ["created_at", "2020-11-22 00:47:33.136289"], ["updated_at", "2020-11-22 00:47:33.136289"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------
SecureApi::TokenTest: test_set_token
------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.7ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "674c18c196ed640b20a7b489fc1b2cde6df9fab94f8efe96d88a52456a617c37$$rkZwk6FdoLreb81Qdtnv9w==--ASgIqbs1ycVvbC7C--VO+PKACKN5h/TYeab2THDw=="], ["created_at", "2020-11-22 00:47:33.191259"], ["updated_at", "2020-11-22 00:47:33.191259"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.1ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo1OCwiZXhwIjoxNjA2MTc4ODUzfQ.OAGYS9ZUm7WkwR_aYm2ctJsGrf043-FQH7y3d9BWUqk"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo1OCwiZXhwIjoxNjA2MTc4ODUzfQ.OAGYS9ZUm7WkwR_aYm2ctJsGrf043-FQH7y3d9BWUqk"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo1OCwiZXhwIjoxNjA2MTc4ODUzfQ.OAGYS9ZUm7WkwR_aYm2ctJsGrf043-FQH7y3d9BWUqk"], ["exp_date", "2020-11-24 00:47:33"], ["resource_type", "User"], ["resource_id", 58], ["created_at", "2020-11-22 00:47:33.194293"], ["updated_at", "2020-11-22 00:47:33.194293"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------
SecureApi::TokenTest: test_decode
---------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "25f2bc10310e5f0ccd11b6d1b3939bac676ab7248175d7d3c1ed69e60f59a26c$$CEF6uoW2psRx4hNiqUKsbw==--X+YS9bTy/6ePFmLr--ie5zgjE5lDafduqqT2BvNA=="], ["created_at", "2020-11-22 00:47:33.241986"], ["updated_at", "2020-11-22 00:47:33.241986"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo1OSwiZXhwIjoxNjA2MTc4ODUzfQ.CBCKuxke6tq3vDxtNMAqpD3bjN9XKLkTldkEKdUSO38"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo1OSwiZXhwIjoxNjA2MTc4ODUzfQ.CBCKuxke6tq3vDxtNMAqpD3bjN9XKLkTldkEKdUSO38"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo1OSwiZXhwIjoxNjA2MTc4ODUzfQ.CBCKuxke6tq3vDxtNMAqpD3bjN9XKLkTldkEKdUSO38"], ["exp_date", "2020-11-24 00:47:33"], ["resource_type", "User"], ["resource_id", 59], ["created_at", "2020-11-22 00:47:33.244735"], ["updated_at", "2020-11-22 00:47:33.244735"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
SecureApi::TokenTest: test_is_expired
-------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "64333bb4dbed671b82025b92edeaa225e8d3d68a913c7b577727e8ccf0e125ac$$8N8vhlEXySD3rqT0YhCoag==--EsMHhcMDUOa2J+21--R9x+PECmD5Q86Ma5StKVIA=="], ["created_at", "2020-11-22 00:47:33.292881"], ["updated_at", "2020-11-22 00:47:33.292881"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo2MCwiZXhwIjoxNjA2MTc4ODUzfQ.8e50VndKBhFjP4TGdhQ-3SI_6HvIulIG1yXc0xMcfe0"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo2MCwiZXhwIjoxNjA2MTc4ODUzfQ.8e50VndKBhFjP4TGdhQ-3SI_6HvIulIG1yXc0xMcfe0"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.9ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo2MCwiZXhwIjoxNjA2MTc4ODUzfQ.8e50VndKBhFjP4TGdhQ-3SI_6HvIulIG1yXc0xMcfe0"], ["exp_date", "2020-11-24 00:47:33"], ["resource_type", "User"], ["resource_id", 60], ["created_at", "2020-11-22 00:47:33.296335"], ["updated_at", "2020-11-22 00:47:33.296335"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
SecureApi::SecureApiControllerTest: test_check_token
----------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "535abf3d4546f392896ba1868349886b328280b4dd4bff2b7fbeef77846a3882$$NJfqcIYmjLgMlD4Dd35oSw==--6p1u7j+bL5LgY+aO--8XBsO8CixpmSKqBO5E7V0A=="], ["created_at", "2020-11-22 00:47:33.365508"], ["updated_at", "2020-11-22 00:47:33.365508"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
SecureApi::SecureApiControllerTest: test_login
----------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "39ee4b1136fb6bda9141ce1371dd97e95477d169cc75b2bddfbfdb10b02aab24$$58fSRc99Mm8ozGdmcsFnfA==--F5qMU/KDN9gz3Fbg--sDgeKHoMN2yKBAHOqmpynQ=="], ["created_at", "2020-11-22 00:47:33.414266"], ["updated_at", "2020-11-22 00:47:33.414266"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/user/login" for 127.0.0.1 at 2020-11-22 01:47:33 +0100
Processing by SecureApi::SecureApiController#login as HTML
  Parameters: {"email"=>"name@example.com", "password"=>"[FILTERED]"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "name@example.com"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."resource_id" = $1 AND "secure_api_tokens"."resource_type" = $2 LIMIT $3[0m  [["resource_id", 62], ["resource_type", "User"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.1ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo2MiwiZXhwIjoxNjA2MTc4ODUzfQ.a_7JWtpMr5nKaziosuFzubYmuTYJtLo-509-PBDnSXs"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo2MiwiZXhwIjoxNjA2MTc4ODUzfQ.a_7JWtpMr5nKaziosuFzubYmuTYJtLo-509-PBDnSXs"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.3ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo2MiwiZXhwIjoxNjA2MTc4ODUzfQ.a_7JWtpMr5nKaziosuFzubYmuTYJtLo-509-PBDnSXs"], ["exp_date", "2020-11-24 00:47:33"], ["resource_type", "User"], ["resource_id", 62], ["created_at", "2020-11-22 00:47:33.493156"], ["updated_at", "2020-11-22 00:47:33.493156"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 62], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."resource_id" = $1 AND "secure_api_tokens"."resource_type" = $2 LIMIT $3[0m  [["resource_id", 62], ["resource_type", "User"], ["LIMIT", 1]]
Completed 200 OK in 59ms (Views: 0.2ms | ActiveRecord: 1.6ms | Allocations: 3403)
Started POST "/user/login" for 127.0.0.1 at 2020-11-22 01:47:33 +0100
Processing by SecureApi::SecureApiController#login as HTML
  Parameters: {"email"=>"name@example.com"}
Completed 401 Unauthorized in 0ms (Views: 0.1ms | ActiveRecord: 0.0ms | Allocations: 139)
  [1m[35m (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
SecureApi::SecureApiControllerTest: test_logout
-----------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "ec87832da146fe8430427f696db0d323aa4b4218ebc9b8c1ce1c6961b5491bd7$$y0Bk8UQlmxYXpZOwZ4f5wg==--lJmgGGQn9rLhHZyx--TeCYjSPMRNvbguusGNORNw=="], ["created_at", "2020-11-22 00:47:33.575191"], ["updated_at", "2020-11-22 00:47:33.575191"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------
SecureApi::Test: test_truth
---------------------------
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------
SecureApi::TokenTest: test_decode
---------------------------------
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "239aa9fe8d822db7f21ab273d1dc3fcf867ad58263bc5af1ce90fdac114f1b24$$5PkDLgE35H0h/B+Mjbj2ag==--eNRYAcrpmHQleyrm--V81MPxB6qnv4Sfjy7VlEQw=="], ["created_at", "2020-11-22 00:47:50.436275"], ["updated_at", "2020-11-22 00:47:50.436275"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.6ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo2NCwiZXhwIjoxNjA2MTc4ODcwfQ.2V2DanbgylO_mRD2iOPc62Llo_Za_cpfF1PX5pqHBYU"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo2NCwiZXhwIjoxNjA2MTc4ODcwfQ.2V2DanbgylO_mRD2iOPc62Llo_Za_cpfF1PX5pqHBYU"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.5ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo2NCwiZXhwIjoxNjA2MTc4ODcwfQ.2V2DanbgylO_mRD2iOPc62Llo_Za_cpfF1PX5pqHBYU"], ["exp_date", "2020-11-24 00:47:50"], ["resource_type", "User"], ["resource_id", 64], ["created_at", "2020-11-22 00:47:50.471761"], ["updated_at", "2020-11-22 00:47:50.471761"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
SecureApi::TokenTest: test_is_expired
-------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "533121d6a255fabe9f0bbc3fd84013bafc9c20610c11dbe098d92da1c86bd9b5$$XbEAiJWf9PcHcxUuAOK1Xg==--9CkDilzGgmWgjNbQ--OA+jd2yY8FJh1FcbImsyXw=="], ["created_at", "2020-11-22 00:47:50.519279"], ["updated_at", "2020-11-22 00:47:50.519279"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.1ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo2NSwiZXhwIjoxNjA2MTc4ODcwfQ.FQTWXqQ_tg2pv902rQYTBfl77PPotR-kv05NipwybhI"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo2NSwiZXhwIjoxNjA2MTc4ODcwfQ.FQTWXqQ_tg2pv902rQYTBfl77PPotR-kv05NipwybhI"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo2NSwiZXhwIjoxNjA2MTc4ODcwfQ.FQTWXqQ_tg2pv902rQYTBfl77PPotR-kv05NipwybhI"], ["exp_date", "2020-11-24 00:47:50"], ["resource_type", "User"], ["resource_id", 65], ["created_at", "2020-11-22 00:47:50.522435"], ["updated_at", "2020-11-22 00:47:50.522435"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------
SecureApi::TokenTest: test_set_token
------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "de59e3532ef7be3fd6796149f006ff39f29ccea7b8ec92aa74efa06d41c7d3a1$$Agt7h0AjhaD6Vp7gRGP3Mg==--pHeMZ4dPM/a6HWqH--Zsgh0u0rEOeHPNvRRmAYcA=="], ["created_at", "2020-11-22 00:47:50.572059"], ["updated_at", "2020-11-22 00:47:50.572059"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo2NiwiZXhwIjoxNjA2MTc4ODcwfQ.aEftt3ckItN2dQyf82GalTWvYlGMSGYpwW2tWCeWJFE"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo2NiwiZXhwIjoxNjA2MTc4ODcwfQ.aEftt3ckItN2dQyf82GalTWvYlGMSGYpwW2tWCeWJFE"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.3ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo2NiwiZXhwIjoxNjA2MTc4ODcwfQ.aEftt3ckItN2dQyf82GalTWvYlGMSGYpwW2tWCeWJFE"], ["exp_date", "2020-11-24 00:47:50"], ["resource_type", "User"], ["resource_id", 66], ["created_at", "2020-11-22 00:47:50.575323"], ["updated_at", "2020-11-22 00:47:50.575323"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------
SecureApi::TokenTest: test_is_ok
--------------------------------
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "869dea864b4ca4a14508f8b031b0ad996de7104b6ec20cba0ef09c6d5d4a4d7f$$5QZUpmvlgINnXatPXLDt9w==--DLJ0jclciilL4SIT--wH/r0Iph7yOXP11zoREiqA=="], ["created_at", "2020-11-22 00:47:50.624846"], ["updated_at", "2020-11-22 00:47:50.624846"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo2NywiZXhwIjoxNjA2MTc4ODcwfQ.I0t3d7QmyxhHK1ab9SfmiAdzqoVMB9lHeKNE62dGzpo"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo2NywiZXhwIjoxNjA2MTc4ODcwfQ.I0t3d7QmyxhHK1ab9SfmiAdzqoVMB9lHeKNE62dGzpo"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.4ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo2NywiZXhwIjoxNjA2MTc4ODcwfQ.I0t3d7QmyxhHK1ab9SfmiAdzqoVMB9lHeKNE62dGzpo"], ["exp_date", "2020-11-24 00:47:50"], ["resource_type", "User"], ["resource_id", 67], ["created_at", "2020-11-22 00:47:50.629011"], ["updated_at", "2020-11-22 00:47:50.629011"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
SecureApi::SecureApiControllerTest: test_check_token
----------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "7404f02a9da3b5b8fe8b56532529081fb2d48d4cdd30835950718fa9e84cf86b$$fqLHFdTjqdk3RymV9BTdoQ==--0RnEDmZQRj7Xsvgn--OQ/ZDXQq0UwtimOe5FUemQ=="], ["created_at", "2020-11-22 00:47:50.709952"], ["updated_at", "2020-11-22 00:47:50.709952"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.3ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
SecureApi::SecureApiControllerTest: test_login
----------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "9d47fc38e46238230bfd4306fdab78ddfa2d8a762fd47a47fcadbe66161a8ff2$$H7xPKpASPs8YXJsVJjKetQ==--YJg4rYbgqVJsgnZs--uqYco8ch3kt60V+MxYQdiw=="], ["created_at", "2020-11-22 00:47:50.765888"], ["updated_at", "2020-11-22 00:47:50.765888"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/user/login" for 127.0.0.1 at 2020-11-22 01:47:50 +0100
Processing by SecureApi::SecureApiController#login as HTML
  Parameters: {"email"=>"name@example.com", "password"=>"[FILTERED]"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "name@example.com"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."resource_id" = $1 AND "secure_api_tokens"."resource_type" = $2 LIMIT $3[0m  [["resource_id", 69], ["resource_type", "User"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.1ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo2OSwiZXhwIjoxNjA2MTc4ODcwfQ.x0V3xHBvK9dYJOPwRvxv-c7fI0b2fd4W_aNjMPqmfVY"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo2OSwiZXhwIjoxNjA2MTc4ODcwfQ.x0V3xHBvK9dYJOPwRvxv-c7fI0b2fd4W_aNjMPqmfVY"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo2OSwiZXhwIjoxNjA2MTc4ODcwfQ.x0V3xHBvK9dYJOPwRvxv-c7fI0b2fd4W_aNjMPqmfVY"], ["exp_date", "2020-11-24 00:47:50"], ["resource_type", "User"], ["resource_id", 69], ["created_at", "2020-11-22 00:47:50.849914"], ["updated_at", "2020-11-22 00:47:50.849914"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 69], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."resource_id" = $1 AND "secure_api_tokens"."resource_type" = $2 LIMIT $3[0m  [["resource_id", 69], ["resource_type", "User"], ["LIMIT", 1]]
Completed 200 OK in 59ms (Views: 0.2ms | ActiveRecord: 1.4ms | Allocations: 3403)
Started POST "/user/login" for 127.0.0.1 at 2020-11-22 01:47:50 +0100
Processing by SecureApi::SecureApiController#login as HTML
  Parameters: {"email"=>"name@example.com"}
Completed 401 Unauthorized in 0ms (Views: 0.1ms | ActiveRecord: 0.0ms | Allocations: 139)
  [1m[35m (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
SecureApi::SecureApiControllerTest: test_logout
-----------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "297f544fc98c2754a6c98f212c96183d245cdd31bfd337bb69e3b95adf48ea74$$f8yY7+oFmsKIXvjyk9dQpw==--zksYEWso7XIMhtvq--HFHjOflswaazthgAbaSENw=="], ["created_at", "2020-11-22 00:47:50.921165"], ["updated_at", "2020-11-22 00:47:50.921165"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------
SecureApi::Test: test_truth
---------------------------
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------
SecureApi::Test: test_truth
---------------------------
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
SecureApi::SecureApiControllerTest: test_check_token
----------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "75ecb8379a55b8edacc76e09eaa6e2663ededdb78ec7ed640e2dd6923695428d$$DGyAMwYSovmKd/V7hiGJeg==--76Cj2lhfXkaezORo--+i/J1MKOxSSTygCwtHNFzA=="], ["created_at", "2020-11-22 00:48:03.440538"], ["updated_at", "2020-11-22 00:48:03.440538"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
SecureApi::SecureApiControllerTest: test_login
----------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "c23affa2db49407d0357bd110e24747cfe0d095d7bc767af261dafc7d24c29ce$$l4Wu8ftSkLz+LQK5DLjzkA==--Qb/U5e8J9NQf7ab9--UWp6a+208MlnRM7gnU6ndw=="], ["created_at", "2020-11-22 00:48:03.489248"], ["updated_at", "2020-11-22 00:48:03.489248"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/user/login" for 127.0.0.1 at 2020-11-22 01:48:03 +0100
Processing by SecureApi::SecureApiController#login as HTML
  Parameters: {"email"=>"name@example.com", "password"=>"[FILTERED]"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "name@example.com"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Load (0.4ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."resource_id" = $1 AND "secure_api_tokens"."resource_type" = $2 LIMIT $3[0m  [["resource_id", 72], ["resource_type", "User"], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo3MiwiZXhwIjoxNjA2MTc4ODgzfQ.Cj7zoT3jjRM3rXXx23O5yaZJpoeYjKz-YA7_IoKBlAM"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo3MiwiZXhwIjoxNjA2MTc4ODgzfQ.Cj7zoT3jjRM3rXXx23O5yaZJpoeYjKz-YA7_IoKBlAM"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.4ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo3MiwiZXhwIjoxNjA2MTc4ODgzfQ.Cj7zoT3jjRM3rXXx23O5yaZJpoeYjKz-YA7_IoKBlAM"], ["exp_date", "2020-11-24 00:48:03"], ["resource_type", "User"], ["resource_id", 72], ["created_at", "2020-11-22 00:48:03.593948"], ["updated_at", "2020-11-22 00:48:03.593948"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 72], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."resource_id" = $1 AND "secure_api_tokens"."resource_type" = $2 LIMIT $3[0m  [["resource_id", 72], ["resource_type", "User"], ["LIMIT", 1]]
Completed 200 OK in 86ms (Views: 0.2ms | ActiveRecord: 5.1ms | Allocations: 12822)
Started POST "/user/login" for 127.0.0.1 at 2020-11-22 01:48:03 +0100
Processing by SecureApi::SecureApiController#login as HTML
  Parameters: {"email"=>"name@example.com"}
Completed 401 Unauthorized in 0ms (Views: 0.1ms | ActiveRecord: 0.0ms | Allocations: 139)
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
SecureApi::SecureApiControllerTest: test_logout
-----------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "a3e57a09aa8dc18e38f51df63680c8d189baf1ad31cdef9fb2861fe7b8d6e11f$$4NzNZ/UaXwExvNI4evZPjA==--Fi0GKn2imvsyco8Z--vB5Ao/XwrNKhtkvXBxdgXA=="], ["created_at", "2020-11-22 00:48:03.653970"], ["updated_at", "2020-11-22 00:48:03.653970"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------
SecureApi::TokenTest: test_decode
---------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "e1fe4c90e65de937205ae71318f078065a0616ca513a246342e85a30b7cdadb4$$WzAeuNy88XG4IPHDeXwYaQ==--iJGn4Tb25SEhhHHs--/dJcFS9Bdpl3tqFAbvpNEA=="], ["created_at", "2020-11-22 00:48:03.702641"], ["updated_at", "2020-11-22 00:48:03.702641"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.1ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo3NCwiZXhwIjoxNjA2MTc4ODgzfQ.Z2aKU9BvdQREUiUrTK4d5RFnQepYdRpl8Q86MlBxRfU"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo3NCwiZXhwIjoxNjA2MTc4ODgzfQ.Z2aKU9BvdQREUiUrTK4d5RFnQepYdRpl8Q86MlBxRfU"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo3NCwiZXhwIjoxNjA2MTc4ODgzfQ.Z2aKU9BvdQREUiUrTK4d5RFnQepYdRpl8Q86MlBxRfU"], ["exp_date", "2020-11-24 00:48:03"], ["resource_type", "User"], ["resource_id", 74], ["created_at", "2020-11-22 00:48:03.705497"], ["updated_at", "2020-11-22 00:48:03.705497"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
SecureApi::TokenTest: test_is_expired
-------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "fa15d5007f310003628258dd6c580937554dcd7d1d0048cc8cddc55947a50ce7$$df9t9R3toBJgHgRcPjSr+A==--wwTUVs0rurpHTLPu--pQAbUiQswQx0rAFwtqijeg=="], ["created_at", "2020-11-22 00:48:03.752593"], ["updated_at", "2020-11-22 00:48:03.752593"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.1ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo3NSwiZXhwIjoxNjA2MTc4ODgzfQ.IvyLdtAfUg0SVwSUhSKZ6KbHyejqpYWkFlTvs-WN2zQ"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo3NSwiZXhwIjoxNjA2MTc4ODgzfQ.IvyLdtAfUg0SVwSUhSKZ6KbHyejqpYWkFlTvs-WN2zQ"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo3NSwiZXhwIjoxNjA2MTc4ODgzfQ.IvyLdtAfUg0SVwSUhSKZ6KbHyejqpYWkFlTvs-WN2zQ"], ["exp_date", "2020-11-24 00:48:03"], ["resource_type", "User"], ["resource_id", 75], ["created_at", "2020-11-22 00:48:03.755175"], ["updated_at", "2020-11-22 00:48:03.755175"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------
SecureApi::TokenTest: test_is_ok
--------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "49353003b9575a4f45126f3926cbb8817f55425c965b837b6cc1ae4fc075ef3e$$vlK/EmqrLO1UuVziugOarA==--YhoLfNfXys4pnYNA--9tNydfARDwLBhI1jBTK00w=="], ["created_at", "2020-11-22 00:48:03.801778"], ["updated_at", "2020-11-22 00:48:03.801778"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.1ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo3NiwiZXhwIjoxNjA2MTc4ODgzfQ.Mq_J9GJDO4i4j_CGaTA9oe0ytNowRzjAGOK9FpHszFY"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo3NiwiZXhwIjoxNjA2MTc4ODgzfQ.Mq_J9GJDO4i4j_CGaTA9oe0ytNowRzjAGOK9FpHszFY"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo3NiwiZXhwIjoxNjA2MTc4ODgzfQ.Mq_J9GJDO4i4j_CGaTA9oe0ytNowRzjAGOK9FpHszFY"], ["exp_date", "2020-11-24 00:48:03"], ["resource_type", "User"], ["resource_id", 76], ["created_at", "2020-11-22 00:48:03.804226"], ["updated_at", "2020-11-22 00:48:03.804226"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------
SecureApi::TokenTest: test_set_token
------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "967c0e17abc767c0d59943cb75c01232efeff32560d1e063292fc4fd743d71f9$$OnAN3DaJWk2bP9KTOe/2Nw==--zDjFgwq+0E3xvb4h--WrMTpTTh1Ll6+3WuDj1ylg=="], ["created_at", "2020-11-22 00:48:03.850490"], ["updated_at", "2020-11-22 00:48:03.850490"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.1ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo3NywiZXhwIjoxNjA2MTc4ODgzfQ.sfdxcZRzNTS52SACJfxOm5PeVi-CGLdzIeREW6hBe5g"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo3NywiZXhwIjoxNjA2MTc4ODgzfQ.sfdxcZRzNTS52SACJfxOm5PeVi-CGLdzIeREW6hBe5g"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo3NywiZXhwIjoxNjA2MTc4ODgzfQ.sfdxcZRzNTS52SACJfxOm5PeVi-CGLdzIeREW6hBe5g"], ["exp_date", "2020-11-24 00:48:03"], ["resource_type", "User"], ["resource_id", 77], ["created_at", "2020-11-22 00:48:03.852892"], ["updated_at", "2020-11-22 00:48:03.852892"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------
SecureApi::Test: test_truth
---------------------------
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------
SecureApi::TokenTest: test_set_token
------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.8ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "a79542ec18714bcc568c7bfe0706fc2ce107203ccdfc16a267194da7ea77e617$$LiICIuOWUup1Wx14CTdN6w==--zCxjdC7v6a5Eikpu--Ih/GIYgvd5Cn+GRY4b5IZw=="], ["created_at", "2020-11-22 00:48:57.687701"], ["updated_at", "2020-11-22 00:48:57.687701"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.3ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo3OCwiZXhwIjoxNjA2MTc4OTM3fQ.A187Kd2ScvIyqIYNullEI3qo-Jxj6A2o2Jm9UFp5o7Y"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo3OCwiZXhwIjoxNjA2MTc4OTM3fQ.A187Kd2ScvIyqIYNullEI3qo-Jxj6A2o2Jm9UFp5o7Y"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.3ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo3OCwiZXhwIjoxNjA2MTc4OTM3fQ.A187Kd2ScvIyqIYNullEI3qo-Jxj6A2o2Jm9UFp5o7Y"], ["exp_date", "2020-11-24 00:48:57"], ["resource_type", "User"], ["resource_id", 78], ["created_at", "2020-11-22 00:48:57.720039"], ["updated_at", "2020-11-22 00:48:57.720039"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
SecureApi::TokenTest: test_is_expired
-------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "53db50ee4a6eab3d2483699765b9aea24ead686cf3c5446b5b3d912191f294d2$$wEKT6Yj7cKV7SVXjOQ5PFA==--iOgij3e9IRlu7xW/--TYxgMnynAA9tW6OQk3dyUQ=="], ["created_at", "2020-11-22 00:48:57.767680"], ["updated_at", "2020-11-22 00:48:57.767680"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.1ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo3OSwiZXhwIjoxNjA2MTc4OTM3fQ.g6kjOui9NhUm-R52al5kjF6LE44TrRs3_WPuBz634tM"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo3OSwiZXhwIjoxNjA2MTc4OTM3fQ.g6kjOui9NhUm-R52al5kjF6LE44TrRs3_WPuBz634tM"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo3OSwiZXhwIjoxNjA2MTc4OTM3fQ.g6kjOui9NhUm-R52al5kjF6LE44TrRs3_WPuBz634tM"], ["exp_date", "2020-11-24 00:48:57"], ["resource_type", "User"], ["resource_id", 79], ["created_at", "2020-11-22 00:48:57.770846"], ["updated_at", "2020-11-22 00:48:57.770846"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------
SecureApi::TokenTest: test_is_ok
--------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "55f425b594fcd014754aca90fe76f25908659f4b34cd57f744b1b228ce4a5796$$LpHfwmibJNP05NooLw/gvg==--Nip2H5TUeaZdqYLj--UWRl7QEBLZbei4xKkR0BIw=="], ["created_at", "2020-11-22 00:48:57.820487"], ["updated_at", "2020-11-22 00:48:57.820487"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo4MCwiZXhwIjoxNjA2MTc4OTM3fQ.vEmXyM-t1_Hu06Y7JsKTF9-nrS8PzBpM2zq8G_pvi6A"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo4MCwiZXhwIjoxNjA2MTc4OTM3fQ.vEmXyM-t1_Hu06Y7JsKTF9-nrS8PzBpM2zq8G_pvi6A"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo4MCwiZXhwIjoxNjA2MTc4OTM3fQ.vEmXyM-t1_Hu06Y7JsKTF9-nrS8PzBpM2zq8G_pvi6A"], ["exp_date", "2020-11-24 00:48:57"], ["resource_type", "User"], ["resource_id", 80], ["created_at", "2020-11-22 00:48:57.823597"], ["updated_at", "2020-11-22 00:48:57.823597"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------
SecureApi::TokenTest: test_decode
---------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "4d5ca7efc1c78c7e9c32aa4abdcdb1e50e4c7d82c002a352e6a4846acbe641c5$$DfEnHhcdBbz633+kd08hYQ==--ymYVQZYuS1mK0bCw--kmFsSBxz25FvGxplwUaM4A=="], ["created_at", "2020-11-22 00:48:57.872155"], ["updated_at", "2020-11-22 00:48:57.872155"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo4MSwiZXhwIjoxNjA2MTc4OTM3fQ.n4W3YCaPMzuFwVYmPmrqgstAkJONAWCObcLR1h_UeR4"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo4MSwiZXhwIjoxNjA2MTc4OTM3fQ.n4W3YCaPMzuFwVYmPmrqgstAkJONAWCObcLR1h_UeR4"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo4MSwiZXhwIjoxNjA2MTc4OTM3fQ.n4W3YCaPMzuFwVYmPmrqgstAkJONAWCObcLR1h_UeR4"], ["exp_date", "2020-11-24 00:48:57"], ["resource_type", "User"], ["resource_id", 81], ["created_at", "2020-11-22 00:48:57.874802"], ["updated_at", "2020-11-22 00:48:57.874802"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
SecureApi::SecureApiControllerTest: test_check_token
----------------------------------------------------
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "cc3b9ff852c77f5b8e46afa9fb960c46457455ca42f1f41d6eb8780ea0c906a5$$gtSMAr6WyqOdhYGQM3wDYQ==--OuEIab7DEsPbZ6T/--RigifKtSpF4Eca/TboPDGg=="], ["created_at", "2020-11-22 00:48:57.939206"], ["updated_at", "2020-11-22 00:48:57.939206"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
SecureApi::SecureApiControllerTest: test_login
----------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "87169b0fe0315ac0c7d38f434466e572049a33286df2b22199aaf777d895add0$$WmLRCddk4pshkBenG3y2nA==--VHUA/lAqbi3/Vr4Z--9UXAONeTQb2xQlyeWjvBPQ=="], ["created_at", "2020-11-22 00:48:57.987263"], ["updated_at", "2020-11-22 00:48:57.987263"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
Started POST "/user/login" for 127.0.0.1 at 2020-11-22 01:48:57 +0100
Processing by SecureApi::SecureApiController#login as HTML
  Parameters: {"email"=>"name@example.com", "password"=>"[FILTERED]"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "name@example.com"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."resource_id" = $1 AND "secure_api_tokens"."resource_type" = $2 LIMIT $3[0m  [["resource_id", 83], ["resource_type", "User"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.1ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo4MywiZXhwIjoxNjA2MTc4OTM4fQ.sfFSaiFidWnFOUGpaPweyn1dyH0cLuSWfNSX79aYy1s"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo4MywiZXhwIjoxNjA2MTc4OTM4fQ.sfFSaiFidWnFOUGpaPweyn1dyH0cLuSWfNSX79aYy1s"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo4MywiZXhwIjoxNjA2MTc4OTM4fQ.sfFSaiFidWnFOUGpaPweyn1dyH0cLuSWfNSX79aYy1s"], ["exp_date", "2020-11-24 00:48:58"], ["resource_type", "User"], ["resource_id", 83], ["created_at", "2020-11-22 00:48:58.061165"], ["updated_at", "2020-11-22 00:48:58.061165"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 83], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Load (0.1ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."resource_id" = $1 AND "secure_api_tokens"."resource_type" = $2 LIMIT $3[0m  [["resource_id", 83], ["resource_type", "User"], ["LIMIT", 1]]
Completed 200 OK in 55ms (Views: 0.2ms | ActiveRecord: 1.4ms | Allocations: 3403)
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
Started POST "/user/login" for 127.0.0.1 at 2020-11-22 01:48:58 +0100
Processing by SecureApi::SecureApiController#login as HTML
  Parameters: {"email"=>"name@example.com"}
Completed 401 Unauthorized in 0ms (Views: 0.1ms | ActiveRecord: 0.0ms | Allocations: 139)
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
SecureApi::SecureApiControllerTest: test_logout
-----------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "a0257e930018ca1ab0f3b1fedca8a470eaab0dd6251fb0575a90b7d7077dee89$$bCB2xmnIOX8Cz39ttVvnVg==--V015lzWnT6ZpaKTC--lLgqiMZ058yhaBFfFVQ72Q=="], ["created_at", "2020-11-22 00:48:58.119167"], ["updated_at", "2020-11-22 00:48:58.119167"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------
SecureApi::TokenTest: test_is_ok
--------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.7ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "c742d3f70087673a8d315e429c12cac63d45f5182c3230f625ce7520bd927532$$2Bi3nLxcOwpsgfaKd6/4mA==--Tq24yvsvcbS+30wu--5mUwbAUMHeT0/VID9Z7w1A=="], ["created_at", "2020-11-22 00:50:09.190247"], ["updated_at", "2020-11-22 00:50:09.190247"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.4ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo4NSwiZXhwIjoxNjA2MTc5MDA5fQ.HQj6fnsNUY0Rqdze3g1gm2Y8hWJ-nRy1Lu1qIEryglI"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (1.7ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo4NSwiZXhwIjoxNjA2MTc5MDA5fQ.HQj6fnsNUY0Rqdze3g1gm2Y8hWJ-nRy1Lu1qIEryglI"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.5ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo4NSwiZXhwIjoxNjA2MTc5MDA5fQ.HQj6fnsNUY0Rqdze3g1gm2Y8hWJ-nRy1Lu1qIEryglI"], ["exp_date", "2020-11-24 00:50:09"], ["resource_type", "User"], ["resource_id", 85], ["created_at", "2020-11-22 00:50:09.239872"], ["updated_at", "2020-11-22 00:50:09.239872"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------
SecureApi::TokenTest: test_set_token
------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "97b70f837d76eccb547a86ee07a7879c02a355d884324f5b23499a5681343f2f$$dg2f5SgRBhjcI0IlZRlbbQ==--SEfnF8qSNlT5g0cO--rKd6taQU1OIx2Z3QpEZd+w=="], ["created_at", "2020-11-22 00:50:09.289190"], ["updated_at", "2020-11-22 00:50:09.289190"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo4NiwiZXhwIjoxNjA2MTc5MDA5fQ.P8-IZjgPshuybMUkOjrsxX3IUh-94yIzp7l5MtIkVpY"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo4NiwiZXhwIjoxNjA2MTc5MDA5fQ.P8-IZjgPshuybMUkOjrsxX3IUh-94yIzp7l5MtIkVpY"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo4NiwiZXhwIjoxNjA2MTc5MDA5fQ.P8-IZjgPshuybMUkOjrsxX3IUh-94yIzp7l5MtIkVpY"], ["exp_date", "2020-11-24 00:50:09"], ["resource_type", "User"], ["resource_id", 86], ["created_at", "2020-11-22 00:50:09.292546"], ["updated_at", "2020-11-22 00:50:09.292546"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------
SecureApi::TokenTest: test_decode
---------------------------------
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "2109141dcbbec8b0e17d9145b589c68f515e823d5157b8facb5f4d9c071e74fe$$g6RBktzFm1+dd0Y07Gigkg==--jsZ/4yfDYhkqs6Ft--z+7kum7tAbfBA3Yi6E4mOg=="], ["created_at", "2020-11-22 00:50:09.339273"], ["updated_at", "2020-11-22 00:50:09.339273"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo4NywiZXhwIjoxNjA2MTc5MDA5fQ.quhjRr7miDt7Ky_M9WU6ZPatvWoHzYYFkSpzpZjoXog"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo4NywiZXhwIjoxNjA2MTc5MDA5fQ.quhjRr7miDt7Ky_M9WU6ZPatvWoHzYYFkSpzpZjoXog"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo4NywiZXhwIjoxNjA2MTc5MDA5fQ.quhjRr7miDt7Ky_M9WU6ZPatvWoHzYYFkSpzpZjoXog"], ["exp_date", "2020-11-24 00:50:09"], ["resource_type", "User"], ["resource_id", 87], ["created_at", "2020-11-22 00:50:09.343010"], ["updated_at", "2020-11-22 00:50:09.343010"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
SecureApi::TokenTest: test_is_expired
-------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "3db62b37934a0a3116c97f05a33fffd40eef467df2d1e6d8fa3a318e9d4fa49e$$F2WrMgaoHuUbNlSxQTtw+Q==--Q9MrEy4tKsCtjAss--RrhdqyTo05a3yJ0lIlDGDA=="], ["created_at", "2020-11-22 00:50:09.391924"], ["updated_at", "2020-11-22 00:50:09.391924"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.3ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo4OCwiZXhwIjoxNjA2MTc5MDA5fQ.q1F7H-07iGN-OXiggfbOSsQqP0UJZgmz6SP2L3e11fI"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo4OCwiZXhwIjoxNjA2MTc5MDA5fQ.q1F7H-07iGN-OXiggfbOSsQqP0UJZgmz6SP2L3e11fI"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo4OCwiZXhwIjoxNjA2MTc5MDA5fQ.q1F7H-07iGN-OXiggfbOSsQqP0UJZgmz6SP2L3e11fI"], ["exp_date", "2020-11-24 00:50:09"], ["resource_type", "User"], ["resource_id", 88], ["created_at", "2020-11-22 00:50:09.395324"], ["updated_at", "2020-11-22 00:50:09.395324"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------
SecureApi::Test: test_truth
---------------------------
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
SecureApi::SecureApiControllerTest: test_logout
-----------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "b84ab2a81c17b81fd848d81ef6b0f232db6342b7f6ccae3080f3f950068f4158$$Ja1vo9MoIOTVoc7AyvCXng==--KLTGfarajkEgPS1Q--E6lQUiAkTC6/H+2G7CIgXQ=="], ["created_at", "2020-11-22 00:50:09.465049"], ["updated_at", "2020-11-22 00:50:09.465049"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
SecureApi::SecureApiControllerTest: test_check_token
----------------------------------------------------
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "16f874561967e195738e2fc187abc80332ab1b1be32a1a75bae3836facec2d90$$Dk6do2qLDt0X4bD+QaRzuA==--oqFUrqnsj8Ln+jaD--HeHGow53djtzamAnDRTh4A=="], ["created_at", "2020-11-22 00:50:09.512879"], ["updated_at", "2020-11-22 00:50:09.512879"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
SecureApi::SecureApiControllerTest: test_login
----------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "0a04dd0ade573165426ad094d00eb097f9c86c11d69c8d4dd7bdf02cd50b3732$$6xIEPSksOAchw6OtZINvZA==--olC8A7YR5Dxqq3zd--dMf6iCi5qpP7sVmI0Mgj8w=="], ["created_at", "2020-11-22 00:50:09.560585"], ["updated_at", "2020-11-22 00:50:09.560585"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
Started POST "/user/login" for 127.0.0.1 at 2020-11-22 01:50:09 +0100
Processing by SecureApi::SecureApiController#login as HTML
  Parameters: {"email"=>"name@example.com", "password"=>"[FILTERED]"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "name@example.com"], ["LIMIT", 1]]
Completed 401 Unauthorized in 47ms (Views: 0.2ms | ActiveRecord: 0.3ms | Allocations: 578)
  [1m[35m (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
Started POST "/user/login" for 127.0.0.1 at 2020-11-22 01:50:09 +0100
Processing by SecureApi::SecureApiController#login as HTML
  Parameters: {"email"=>"name@example.com", "password"=>"[FILTERED]"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "name@example.com"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."resource_id" = $1 AND "secure_api_tokens"."resource_type" = $2 LIMIT $3[0m  [["resource_id", 91], ["resource_type", "User"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo5MSwiZXhwIjoxNjA2MTc5MDA5fQ.yF9BX4W2CVIi_PTyVI3Z4ovN-pjnUEhyAkceZPjsl00"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo5MSwiZXhwIjoxNjA2MTc5MDA5fQ.yF9BX4W2CVIi_PTyVI3Z4ovN-pjnUEhyAkceZPjsl00"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo5MSwiZXhwIjoxNjA2MTc5MDA5fQ.yF9BX4W2CVIi_PTyVI3Z4ovN-pjnUEhyAkceZPjsl00"], ["exp_date", "2020-11-24 00:50:09"], ["resource_type", "User"], ["resource_id", 91], ["created_at", "2020-11-22 00:50:09.697849"], ["updated_at", "2020-11-22 00:50:09.697849"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 91], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Load (0.1ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."resource_id" = $1 AND "secure_api_tokens"."resource_type" = $2 LIMIT $3[0m  [["resource_id", 91], ["resource_type", "User"], ["LIMIT", 1]]
Completed 200 OK in 59ms (Views: 0.1ms | ActiveRecord: 1.5ms | Allocations: 3134)
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
Started POST "/user/login" for 127.0.0.1 at 2020-11-22 01:50:09 +0100
Processing by SecureApi::SecureApiController#login as HTML
  Parameters: {"email"=>"name@example.com"}
Completed 401 Unauthorized in 0ms (Views: 0.1ms | ActiveRecord: 0.0ms | Allocations: 139)
  [1m[35m (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
SecureApi::SecureApiControllerTest: test_login
----------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.7ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "cadd739fb422b1f46c466c099582f15a054040b92ff1e62ee7b94bb8fef904bf$$J4xdvsNJsu+etp0TAtm9Ug==--FCpfGFA3NttDjv1W--ZdHMoIwc9QZsaj636Eliuw=="], ["created_at", "2020-11-22 00:52:25.336030"], ["updated_at", "2020-11-22 00:52:25.336030"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
Started POST "/user/login" for 127.0.0.1 at 2020-11-22 01:52:25 +0100
Processing by SecureApi::SecureApiController#login as HTML
  Parameters: {"email"=>"name@example.com", "password"=>"[FILTERED]"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "name@example.com"], ["LIMIT", 1]]
Completed 401 Unauthorized in 48ms (Views: 0.2ms | ActiveRecord: 0.4ms | Allocations: 641)
  [1m[35m (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
Started POST "/user/login" for 127.0.0.1 at 2020-11-22 01:52:25 +0100
Processing by SecureApi::SecureApiController#login as HTML
  Parameters: {"email"=>"name@example.com", "password"=>"[FILTERED]"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "name@example.com"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."resource_id" = $1 AND "secure_api_tokens"."resource_type" = $2 LIMIT $3[0m  [["resource_id", 92], ["resource_type", "User"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo5MiwiZXhwIjoxNjA2MTc5MTQ1fQ.bln-V8VlxtlE5CAcIs_j08Oq-djU1X9Sahwk3L8UkXw"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo5MiwiZXhwIjoxNjA2MTc5MTQ1fQ.bln-V8VlxtlE5CAcIs_j08Oq-djU1X9Sahwk3L8UkXw"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.3ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo5MiwiZXhwIjoxNjA2MTc5MTQ1fQ.bln-V8VlxtlE5CAcIs_j08Oq-djU1X9Sahwk3L8UkXw"], ["exp_date", "2020-11-24 00:52:25"], ["resource_type", "User"], ["resource_id", 92], ["created_at", "2020-11-22 00:52:25.508182"], ["updated_at", "2020-11-22 00:52:25.508182"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 92], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."resource_id" = $1 AND "secure_api_tokens"."resource_type" = $2 LIMIT $3[0m  [["resource_id", 92], ["resource_type", "User"], ["LIMIT", 1]]
Completed 200 OK in 72ms (Views: 0.2ms | ActiveRecord: 4.2ms | Allocations: 8123)
  [1m[35m (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
Started POST "/user/login" for 127.0.0.1 at 2020-11-22 01:52:25 +0100
Processing by SecureApi::SecureApiController#login as HTML
  Parameters: {"email"=>"name@example.com"}
Completed 401 Unauthorized in 0ms (Views: 0.1ms | ActiveRecord: 0.0ms | Allocations: 139)
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
SecureApi::SecureApiControllerTest: test_check_token
----------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "65341d6872531bd7339ecca2bb3b98edd7031fabfe3ee73a3524fc1084cf3204$$f3MRWgCl8HGGueb9WT6+hA==--uPD8+2TWIfFPsDV7--ZYKW/K1DP/a3OU1uWPSx3w=="], ["created_at", "2020-11-22 00:52:25.565681"], ["updated_at", "2020-11-22 00:52:25.565681"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
SecureApi::SecureApiControllerTest: test_logout
-----------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "e31fd9bebecfa53e3d5214a75035769556e4cbad253a1fdd3e12484f27d06ab2$$z3Z3E30hGA4ZMepRvi7+rw==--82mK7B1Xp3Kb1SH5--ya4F5wT9WaTDKkBLQx/9uA=="], ["created_at", "2020-11-22 00:52:25.616166"], ["updated_at", "2020-11-22 00:52:25.616166"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
Started DELETE "/user/logout" for 127.0.0.1 at 2020-11-22 01:52:25 +0100
Processing by SecureApi::SecureApiController#logout as HTML
  [1m[36mSecureApi::Token Load (0.3ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
Completed 401 Unauthorized in 2ms (Views: 0.3ms | ActiveRecord: 0.3ms | Allocations: 321)
  [1m[35m (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
  [1m[35m (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------
SecureApi::Test: test_truth
---------------------------
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------
SecureApi::TokenTest: test_is_ok
--------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (2.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "ebfa21ee5b698b1fa134d8d1e3c634e88eb27c72ba9d1ad71fc043c8f92e3495$$ji9Y2zxX7/gIXkSdADvN7w==--ZyLwUOGry1vxU6NN--pOQuSA/xF7iQit2oNu9uMw=="], ["created_at", "2020-11-22 00:52:25.685982"], ["updated_at", "2020-11-22 00:52:25.685982"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (1.5ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo5NSwiZXhwIjoxNjA2MTc5MTQ1fQ.CYJAJ19pAo42N82i9AusRBf80rnARMjQTgheItIjlqs"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo5NSwiZXhwIjoxNjA2MTc5MTQ1fQ.CYJAJ19pAo42N82i9AusRBf80rnARMjQTgheItIjlqs"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.3ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo5NSwiZXhwIjoxNjA2MTc5MTQ1fQ.CYJAJ19pAo42N82i9AusRBf80rnARMjQTgheItIjlqs"], ["exp_date", "2020-11-24 00:52:25"], ["resource_type", "User"], ["resource_id", 95], ["created_at", "2020-11-22 00:52:25.693998"], ["updated_at", "2020-11-22 00:52:25.693998"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------
SecureApi::TokenTest: test_set_token
------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (1.9ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "9f903353b310c889a41f741d313474eca9a9f29b8af56ec57db1875284113b02$$ojLQkpzB9jUdANtIMeTCjw==--mTCbdac+vsg/i6OF--HGCG8sOF4tXZKlp2DxmFdw=="], ["created_at", "2020-11-22 00:52:25.771116"], ["updated_at", "2020-11-22 00:52:25.771116"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.3ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo5NiwiZXhwIjoxNjA2MTc5MTQ1fQ.pBhgImanxbfIa2o0k6YUchmR37ya6UztehgzaIKgEiw"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo5NiwiZXhwIjoxNjA2MTc5MTQ1fQ.pBhgImanxbfIa2o0k6YUchmR37ya6UztehgzaIKgEiw"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.3ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo5NiwiZXhwIjoxNjA2MTc5MTQ1fQ.pBhgImanxbfIa2o0k6YUchmR37ya6UztehgzaIKgEiw"], ["exp_date", "2020-11-24 00:52:25"], ["resource_type", "User"], ["resource_id", 96], ["created_at", "2020-11-22 00:52:25.776357"], ["updated_at", "2020-11-22 00:52:25.776357"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------
SecureApi::TokenTest: test_decode
---------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "f4ec209aaf6a7f747be7ff55631f9542f075ec4c9fb6158969797968e38772b3$$1k3NULD3tz8mXnTA5yx4fA==--qgd7H0j05Yv7cGDV--KSdNeY5Tjc/cCpxgBzSRSA=="], ["created_at", "2020-11-22 00:52:25.832276"], ["updated_at", "2020-11-22 00:52:25.832276"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo5NywiZXhwIjoxNjA2MTc5MTQ1fQ.JalK--wQQkE7FdOKoMcu6ZudIMIuMW4zW9GsKKwfPDs"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo5NywiZXhwIjoxNjA2MTc5MTQ1fQ.JalK--wQQkE7FdOKoMcu6ZudIMIuMW4zW9GsKKwfPDs"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.3ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo5NywiZXhwIjoxNjA2MTc5MTQ1fQ.JalK--wQQkE7FdOKoMcu6ZudIMIuMW4zW9GsKKwfPDs"], ["exp_date", "2020-11-24 00:52:25"], ["resource_type", "User"], ["resource_id", 97], ["created_at", "2020-11-22 00:52:25.835410"], ["updated_at", "2020-11-22 00:52:25.835410"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
SecureApi::TokenTest: test_is_expired
-------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "e9e04b33deea768d52c37de52cd5b83a05b8f35bbf38a431f99d53be71dcdd3e$$Vt/CsJw838Yz972DKB17Aw==--L1eR0KJaNwgoKgKP--rNt2aLyh2AfVYvTydYdFLg=="], ["created_at", "2020-11-22 00:52:25.883082"], ["updated_at", "2020-11-22 00:52:25.883082"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.1ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo5OCwiZXhwIjoxNjA2MTc5MTQ1fQ.zjZym5AuREmrt9wV0ZF0SnXizZE8OlGN-GZzprTUoDU"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo5OCwiZXhwIjoxNjA2MTc5MTQ1fQ.zjZym5AuREmrt9wV0ZF0SnXizZE8OlGN-GZzprTUoDU"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.3ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo5OCwiZXhwIjoxNjA2MTc5MTQ1fQ.zjZym5AuREmrt9wV0ZF0SnXizZE8OlGN-GZzprTUoDU"], ["exp_date", "2020-11-24 00:52:25"], ["resource_type", "User"], ["resource_id", 98], ["created_at", "2020-11-22 00:52:25.886162"], ["updated_at", "2020-11-22 00:52:25.886162"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------
SecureApi::TokenTest: test_decode
---------------------------------
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (1.0ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "2c056702b602b48382d35c6a0f280e6d7becefbf76e01db0fb0a56634167d0b4$$kDiTLlvy5aWZgCOmy3v+Eg==--1SEH96UbjfodxAUN--f2awoVFgWik24hxogsdeEA=="], ["created_at", "2020-11-22 00:53:40.864802"], ["updated_at", "2020-11-22 00:53:40.864802"]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.4ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo5OSwiZXhwIjoxNjA2MTc5MjIwfQ.xnOCjrH58ZUgTNxbSE9SWlsxIc5p_miOz_Ee20mRvqI"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo5OSwiZXhwIjoxNjA2MTc5MjIwfQ.xnOCjrH58ZUgTNxbSE9SWlsxIc5p_miOz_Ee20mRvqI"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.3ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjo5OSwiZXhwIjoxNjA2MTc5MjIwfQ.xnOCjrH58ZUgTNxbSE9SWlsxIc5p_miOz_Ee20mRvqI"], ["exp_date", "2020-11-24 00:53:40"], ["resource_type", "User"], ["resource_id", 99], ["created_at", "2020-11-22 00:53:40.906827"], ["updated_at", "2020-11-22 00:53:40.906827"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
SecureApi::TokenTest: test_is_expired
-------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "d8174be28a6accaeaaf1318e3642b5e86c1f66fa24e891872ea9b5b37801ad3e$$iyfPRl+i07eldDBPAgS90g==--KRUPB7ZLXMsRIlIp--wSQEnF8JSft9HHONwCTSuA=="], ["created_at", "2020-11-22 00:53:40.960498"], ["updated_at", "2020-11-22 00:53:40.960498"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMDAsImV4cCI6MTYwNjE3OTIyMH0.HU6esVeALDS9fI93jftsdfsRTjyEKPb8X8Y2754RHYc"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMDAsImV4cCI6MTYwNjE3OTIyMH0.HU6esVeALDS9fI93jftsdfsRTjyEKPb8X8Y2754RHYc"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMDAsImV4cCI6MTYwNjE3OTIyMH0.HU6esVeALDS9fI93jftsdfsRTjyEKPb8X8Y2754RHYc"], ["exp_date", "2020-11-24 00:53:40"], ["resource_type", "User"], ["resource_id", 100], ["created_at", "2020-11-22 00:53:40.963764"], ["updated_at", "2020-11-22 00:53:40.963764"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------
SecureApi::TokenTest: test_is_ok
--------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "f43be43b4bda81de826697ae7635f5212935e8ee7f6f5d8e31458df7da9e28f3$$x1iaTr9S/Z3WAmfP7HN5bQ==--e20aDLgFq02r/qpo--cgx1+HBkMU0Xe1G78XtoeA=="], ["created_at", "2020-11-22 00:53:41.012350"], ["updated_at", "2020-11-22 00:53:41.012350"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMDEsImV4cCI6MTYwNjE3OTIyMX0.U5lQaE0xhFCN2eKKAzmIIeCxUNF8m0StwhV2j6THRYk"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMDEsImV4cCI6MTYwNjE3OTIyMX0.U5lQaE0xhFCN2eKKAzmIIeCxUNF8m0StwhV2j6THRYk"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMDEsImV4cCI6MTYwNjE3OTIyMX0.U5lQaE0xhFCN2eKKAzmIIeCxUNF8m0StwhV2j6THRYk"], ["exp_date", "2020-11-24 00:53:41"], ["resource_type", "User"], ["resource_id", 101], ["created_at", "2020-11-22 00:53:41.015206"], ["updated_at", "2020-11-22 00:53:41.015206"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------
SecureApi::TokenTest: test_set_token
------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "f3364cae26166019aebdfdb82a7261c7bc5eba9cd25b96599ccb108e079c27b8$$j2QXCp944emV5keqeqVAEw==--1P2vPQ8RVh+0afph--ATgZWpHja4tV/pJMNJQUow=="], ["created_at", "2020-11-22 00:53:41.062222"], ["updated_at", "2020-11-22 00:53:41.062222"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMDIsImV4cCI6MTYwNjE3OTIyMX0.lKdUrNsVW17fQ-aXMqwE9l9hmjrweGfUSa94ybFaQpA"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMDIsImV4cCI6MTYwNjE3OTIyMX0.lKdUrNsVW17fQ-aXMqwE9l9hmjrweGfUSa94ybFaQpA"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMDIsImV4cCI6MTYwNjE3OTIyMX0.lKdUrNsVW17fQ-aXMqwE9l9hmjrweGfUSa94ybFaQpA"], ["exp_date", "2020-11-24 00:53:41"], ["resource_type", "User"], ["resource_id", 102], ["created_at", "2020-11-22 00:53:41.065165"], ["updated_at", "2020-11-22 00:53:41.065165"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
SecureApi::SecureApiControllerTest: test_check_token
----------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "1f662ed6e6aeef7659f9cca8ec83ba0809353d090ec5e9c5ffb90f2e851b3de5$$HiJVFkIC9oxEWUT+vfvdNg==--fBVIij+QDvC3lSdg--vZX7niALLK2GBgrWQ2cnMA=="], ["created_at", "2020-11-22 00:53:41.138588"], ["updated_at", "2020-11-22 00:53:41.138588"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
SecureApi::SecureApiControllerTest: test_logout
-----------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "30f12047d68122a65331eac50c09867e279541d68c01867c9684dc60d6b5d395$$FgWqu0uKghPsxof6tjKJGA==--i+QELn13oPiRL38n--x8Yjq1VrRRLllbL1NcXqGw=="], ["created_at", "2020-11-22 00:53:41.185686"], ["updated_at", "2020-11-22 00:53:41.185686"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
Started DELETE "/user/logout" for 127.0.0.1 at 2020-11-22 01:53:41 +0100
Processing by SecureApi::SecureApiController#logout as HTML
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
Completed 401 Unauthorized in 1ms (Views: 0.2ms | ActiveRecord: 0.2ms | Allocations: 422)
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMDQsImV4cCI6MTYwNjE3OTIyMX0.6iogjlm0zaP_1D4Jfrur3tej3mzd2V67adEls8V-xlU"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMDQsImV4cCI6MTYwNjE3OTIyMX0.6iogjlm0zaP_1D4Jfrur3tej3mzd2V67adEls8V-xlU"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMDQsImV4cCI6MTYwNjE3OTIyMX0.6iogjlm0zaP_1D4Jfrur3tej3mzd2V67adEls8V-xlU"], ["exp_date", "2020-11-24 00:53:41"], ["resource_type", "User"], ["resource_id", 104], ["created_at", "2020-11-22 00:53:41.218933"], ["updated_at", "2020-11-22 00:53:41.218933"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
Started DELETE "/user/logout" for 127.0.0.1 at 2020-11-22 01:53:41 +0100
Processing by SecureApi::SecureApiController#logout as HTML
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMDQsImV4cCI6MTYwNjE3OTIyMX0.6iogjlm0zaP_1D4Jfrur3tej3mzd2V67adEls8V-xlU"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Destroy (0.3ms)[0m  [1m[31mDELETE FROM "secure_api_tokens" WHERE "secure_api_tokens"."id" = $1[0m  [["id", 77]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 2ms (ActiveRecord: 0.7ms | Allocations: 374)
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
SecureApi::SecureApiControllerTest: test_login
----------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "a3d3ddaae3a53d8ac5ded6a661861f3f938556f50380b54bee3ccbbbfb41f982$$BpT0mkdxVJVnzbyJh4iUIA==--meg5Fe7LyIhzIYSe--CVmQ9F6YrYeEjmIItM6XGw=="], ["created_at", "2020-11-22 00:53:41.277659"], ["updated_at", "2020-11-22 00:53:41.277659"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
Started POST "/user/login" for 127.0.0.1 at 2020-11-22 01:53:41 +0100
Processing by SecureApi::SecureApiController#login as HTML
  Parameters: {"email"=>"name@example.com", "password"=>"[FILTERED]"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "name@example.com"], ["LIMIT", 1]]
Completed 401 Unauthorized in 46ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 478)
  [1m[35m (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
Started POST "/user/login" for 127.0.0.1 at 2020-11-22 01:53:41 +0100
Processing by SecureApi::SecureApiController#login as HTML
  Parameters: {"email"=>"name@example.com", "password"=>"[FILTERED]"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "name@example.com"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."resource_id" = $1 AND "secure_api_tokens"."resource_type" = $2 LIMIT $3[0m  [["resource_id", 105], ["resource_type", "User"], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.1ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMDUsImV4cCI6MTYwNjE3OTIyMX0.E9Q8IGTG10dgiL2jgb-tAmxbLSvGNPnHSyDQpAb78_U"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMDUsImV4cCI6MTYwNjE3OTIyMX0.E9Q8IGTG10dgiL2jgb-tAmxbLSvGNPnHSyDQpAb78_U"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMDUsImV4cCI6MTYwNjE3OTIyMX0.E9Q8IGTG10dgiL2jgb-tAmxbLSvGNPnHSyDQpAb78_U"], ["exp_date", "2020-11-24 00:53:41"], ["resource_type", "User"], ["resource_id", 105], ["created_at", "2020-11-22 00:53:41.393483"], ["updated_at", "2020-11-22 00:53:41.393483"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 105], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."resource_id" = $1 AND "secure_api_tokens"."resource_type" = $2 LIMIT $3[0m  [["resource_id", 105], ["resource_type", "User"], ["LIMIT", 1]]
Completed 200 OK in 57ms (Views: 0.2ms | ActiveRecord: 1.6ms | Allocations: 3121)
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
Started POST "/user/login" for 127.0.0.1 at 2020-11-22 01:53:41 +0100
Processing by SecureApi::SecureApiController#login as HTML
  Parameters: {"email"=>"name@example.com"}
Completed 401 Unauthorized in 0ms (Views: 0.2ms | ActiveRecord: 0.0ms | Allocations: 139)
  [1m[35m (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------
SecureApi::Test: test_truth
---------------------------
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------
SecureApi::TokenTest: test_set_token
------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.8ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "28e944847bf71ada7ac9c5693cf6b19c501ae5447dd94f0da4eaeaf8406b03a7$$Q+7C8qagFP5bzo9KQ/qf1A==--0b6e06h7PjeAAYO0--TIBbDr/RoR9JVfXmRAoO1A=="], ["created_at", "2020-11-22 00:55:07.874872"], ["updated_at", "2020-11-22 00:55:07.874872"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.3ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMDYsImV4cCI6MTYwNjE3OTMwN30.fpZL8ub6pKLHgqJ3joQlUeL1KHMHwUnqkvAV3ViquCw"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMDYsImV4cCI6MTYwNjE3OTMwN30.fpZL8ub6pKLHgqJ3joQlUeL1KHMHwUnqkvAV3ViquCw"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.7ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMDYsImV4cCI6MTYwNjE3OTMwN30.fpZL8ub6pKLHgqJ3joQlUeL1KHMHwUnqkvAV3ViquCw"], ["exp_date", "2020-11-24 00:55:07"], ["resource_type", "User"], ["resource_id", 106], ["created_at", "2020-11-22 00:55:07.915111"], ["updated_at", "2020-11-22 00:55:07.915111"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
SecureApi::TokenTest: test_is_expired
-------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "ff02974807174c8c40ac608cf7b340cbf2e5037b69867e5d0f5808bcc413173e$$zsagXi7g0e48Z9yrqHXL2A==--jArXrojyFtdWZ3bo--szrGTmFpk4G49DrYq8eecg=="], ["created_at", "2020-11-22 00:55:07.964078"], ["updated_at", "2020-11-22 00:55:07.964078"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMDcsImV4cCI6MTYwNjE3OTMwN30.3QOFE8dKkgOXdUmm7auAFfhoi6Jj-PkgflotmvGru8U"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMDcsImV4cCI6MTYwNjE3OTMwN30.3QOFE8dKkgOXdUmm7auAFfhoi6Jj-PkgflotmvGru8U"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.3ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMDcsImV4cCI6MTYwNjE3OTMwN30.3QOFE8dKkgOXdUmm7auAFfhoi6Jj-PkgflotmvGru8U"], ["exp_date", "2020-11-24 00:55:07"], ["resource_type", "User"], ["resource_id", 107], ["created_at", "2020-11-22 00:55:07.967425"], ["updated_at", "2020-11-22 00:55:07.967425"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------
SecureApi::TokenTest: test_decode
---------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "cb294a2afe888a63051a8a8e1c967f6dcf620de493809e9ed7bb87f81f4db788$$siF2U9tpu9ySU/+QXRhPag==--0IvYF4xrwGB9RW2u--lZfvvyvLQixXBRoe0yxmcA=="], ["created_at", "2020-11-22 00:55:08.015995"], ["updated_at", "2020-11-22 00:55:08.015995"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMDgsImV4cCI6MTYwNjE3OTMwOH0.kW831NBX6eqjeLNvK_h07FClSQ2kbETYYUwhSFA98Tw"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMDgsImV4cCI6MTYwNjE3OTMwOH0.kW831NBX6eqjeLNvK_h07FClSQ2kbETYYUwhSFA98Tw"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.6ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMDgsImV4cCI6MTYwNjE3OTMwOH0.kW831NBX6eqjeLNvK_h07FClSQ2kbETYYUwhSFA98Tw"], ["exp_date", "2020-11-24 00:55:08"], ["resource_type", "User"], ["resource_id", 108], ["created_at", "2020-11-22 00:55:08.018882"], ["updated_at", "2020-11-22 00:55:08.018882"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------
SecureApi::TokenTest: test_is_ok
--------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "3f3ec33723e5ca3eef1881096de256cd09362ed145a753c133614e47c329dd5c$$uDy8WhDkuQElG0qG1oxoVw==--7r6tj3quVOU28nWT--Cb08meY+y8Vi+zyYm+53Hw=="], ["created_at", "2020-11-22 00:55:08.066241"], ["updated_at", "2020-11-22 00:55:08.066241"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.1ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMDksImV4cCI6MTYwNjE3OTMwOH0.qQRGCKamuazjhMeJNKZQ6nIwz7fZBBthwlMljLXfT2U"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMDksImV4cCI6MTYwNjE3OTMwOH0.qQRGCKamuazjhMeJNKZQ6nIwz7fZBBthwlMljLXfT2U"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMDksImV4cCI6MTYwNjE3OTMwOH0.qQRGCKamuazjhMeJNKZQ6nIwz7fZBBthwlMljLXfT2U"], ["exp_date", "2020-11-24 00:55:08"], ["resource_type", "User"], ["resource_id", 109], ["created_at", "2020-11-22 00:55:08.068744"], ["updated_at", "2020-11-22 00:55:08.068744"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------
SecureApi::Test: test_truth
---------------------------
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
SecureApi::SecureApiControllerTest: test_check_token
----------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "f247881480ca22f90520c1cbbfc03e9fdfbfcfdcfa84c283c53207cb4b2f219a$$gUNqJMaN/oBCuJBdoNxtHA==--kV0q13abfeKdY/Ue--2Ku2dY7wfWsoOgkmIT6OxQ=="], ["created_at", "2020-11-22 00:55:08.139076"], ["updated_at", "2020-11-22 00:55:08.139076"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMTAsImV4cCI6MTYwNjE3OTMwOH0.2DuHNvAtYtzdWNczZ84aiZQI7ifkc9mL_5IdhRYLV1E"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMTAsImV4cCI6MTYwNjE3OTMwOH0.2DuHNvAtYtzdWNczZ84aiZQI7ifkc9mL_5IdhRYLV1E"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMTAsImV4cCI6MTYwNjE3OTMwOH0.2DuHNvAtYtzdWNczZ84aiZQI7ifkc9mL_5IdhRYLV1E"], ["exp_date", "2020-11-24 00:55:08"], ["resource_type", "User"], ["resource_id", 110], ["created_at", "2020-11-22 00:55:08.141685"], ["updated_at", "2020-11-22 00:55:08.141685"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/user/check_token?access_token=eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMTAsImV4cCI6MTYwNjE3OTMwOH0.2DuHNvAtYtzdWNczZ84aiZQI7ifkc9mL_5IdhRYLV1E" for 127.0.0.1 at 2020-11-22 01:55:08 +0100
Processing by SecureApi::SecureApiController#check_token as HTML
  Parameters: {"access_token"=>"eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMTAsImV4cCI6MTYwNjE3OTMwOH0.2DuHNvAtYtzdWNczZ84aiZQI7ifkc9mL_5IdhRYLV1E"}
  [1m[36mSecureApi::Token Load (0.3ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMTAsImV4cCI6MTYwNjE3OTMwOH0.2DuHNvAtYtzdWNczZ84aiZQI7ifkc9mL_5IdhRYLV1E"], ["LIMIT", 1]]
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 110], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."resource_id" = $1 AND "secure_api_tokens"."resource_type" = $2 LIMIT $3[0m  [["resource_id", 110], ["resource_type", "User"], ["LIMIT", 1]]
Completed 200 OK in 9ms (Views: 0.2ms | ActiveRecord: 0.8ms | Allocations: 2466)
Started GET "/user/check_token?access_token=eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMTAsImV4cCI6MTYwNjE3OTMwOH0.2DuHNvAtYtzdWNczZ84aiZQI7ifkc9mL_5IdhRYLV1E" for 127.0.0.1 at 2020-11-25 01:55:08 +0100
Processing by SecureApi::SecureApiController#check_token as HTML
  Parameters: {"access_token"=>"eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMTAsImV4cCI6MTYwNjE3OTMwOH0.2DuHNvAtYtzdWNczZ84aiZQI7ifkc9mL_5IdhRYLV1E"}
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMTAsImV4cCI6MTYwNjE3OTMwOH0.2DuHNvAtYtzdWNczZ84aiZQI7ifkc9mL_5IdhRYLV1E"], ["LIMIT", 1]]
Completed 401 Unauthorized in 1ms (Views: 0.2ms | ActiveRecord: 0.2ms | Allocations: 342)
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
SecureApi::SecureApiControllerTest: test_login
----------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "61b1ab4b51bd01cfee16fbe348bb8d0b4045ca18a61c6a328d68db54dc446a43$$1KMKg41ILTBbyYZw6s9ifA==--wsqAlUO3CIWYG6v7--6LsZ5SDxGyAHjVvKAA3BaA=="], ["created_at", "2020-11-22 00:55:08.228953"], ["updated_at", "2020-11-22 00:55:08.228953"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
Started POST "/user/login" for 127.0.0.1 at 2020-11-22 01:55:08 +0100
Processing by SecureApi::SecureApiController#login as HTML
  Parameters: {"email"=>"name@example.com", "password"=>"[FILTERED]"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "name@example.com"], ["LIMIT", 1]]
Completed 401 Unauthorized in 50ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 463)
  [1m[35m (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
Started POST "/user/login" for 127.0.0.1 at 2020-11-22 01:55:08 +0100
Processing by SecureApi::SecureApiController#login as HTML
  Parameters: {"email"=>"name@example.com", "password"=>"[FILTERED]"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "name@example.com"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Load (0.3ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."resource_id" = $1 AND "secure_api_tokens"."resource_type" = $2 LIMIT $3[0m  [["resource_id", 111], ["resource_type", "User"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.1ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMTEsImV4cCI6MTYwNjE3OTMwOH0.gi9xepynPo30kbLs5WPKIddIWcVP-2IRAIMpSia8zMU"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMTEsImV4cCI6MTYwNjE3OTMwOH0.gi9xepynPo30kbLs5WPKIddIWcVP-2IRAIMpSia8zMU"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMTEsImV4cCI6MTYwNjE3OTMwOH0.gi9xepynPo30kbLs5WPKIddIWcVP-2IRAIMpSia8zMU"], ["exp_date", "2020-11-24 00:55:08"], ["resource_type", "User"], ["resource_id", 111], ["created_at", "2020-11-22 00:55:08.354241"], ["updated_at", "2020-11-22 00:55:08.354241"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 111], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."resource_id" = $1 AND "secure_api_tokens"."resource_type" = $2 LIMIT $3[0m  [["resource_id", 111], ["resource_type", "User"], ["LIMIT", 1]]
Completed 200 OK in 53ms (Views: 0.1ms | ActiveRecord: 1.6ms | Allocations: 1967)
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
Started POST "/user/login" for 127.0.0.1 at 2020-11-22 01:55:08 +0100
Processing by SecureApi::SecureApiController#login as HTML
  Parameters: {"email"=>"name@example.com"}
Completed 401 Unauthorized in 0ms (Views: 0.1ms | ActiveRecord: 0.0ms | Allocations: 139)
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
SecureApi::SecureApiControllerTest: test_logout
-----------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "eaa0f35d29bd520dd425cc7d09645c354723eac57d5d91b93081cbfa478cf936$$9YZ0MW6aQWecJQj8jrgXmw==--Nvzoh2ZMOnnoR5lj--tfwYQCdQR7Wi3CmO3024mQ=="], ["created_at", "2020-11-22 00:55:08.411171"], ["updated_at", "2020-11-22 00:55:08.411171"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
Started DELETE "/user/logout" for 127.0.0.1 at 2020-11-22 01:55:08 +0100
Processing by SecureApi::SecureApiController#logout as HTML
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
Completed 401 Unauthorized in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 321)
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.1ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMTIsImV4cCI6MTYwNjE3OTMwOH0.ofB9EGelMcFSsViqILvFXJD6QIQ5KnTsUzkxlX_Dluk"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMTIsImV4cCI6MTYwNjE3OTMwOH0.ofB9EGelMcFSsViqILvFXJD6QIQ5KnTsUzkxlX_Dluk"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMTIsImV4cCI6MTYwNjE3OTMwOH0.ofB9EGelMcFSsViqILvFXJD6QIQ5KnTsUzkxlX_Dluk"], ["exp_date", "2020-11-24 00:55:08"], ["resource_type", "User"], ["resource_id", 112], ["created_at", "2020-11-22 00:55:08.422526"], ["updated_at", "2020-11-22 00:55:08.422526"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
Started DELETE "/user/logout" for 127.0.0.1 at 2020-11-22 01:55:08 +0100
Processing by SecureApi::SecureApiController#logout as HTML
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMTIsImV4cCI6MTYwNjE3OTMwOH0.ofB9EGelMcFSsViqILvFXJD6QIQ5KnTsUzkxlX_Dluk"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Destroy (0.2ms)[0m  [1m[31mDELETE FROM "secure_api_tokens" WHERE "secure_api_tokens"."id" = $1[0m  [["id", 85]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 2ms (ActiveRecord: 0.7ms | Allocations: 362)
  [1m[35m (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
SecureApi::SecureApiControllerTest: test_check_token
----------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.7ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "5905ab2e5bcae3858232a0428013a3aa078d74c5d3929b9990bf2a6e3e5e5987$$dnyxwaG0fyEgEKNDZQNZZg==--h/5ESpDDrpXmUUOn--w8qoGCdNDj/eAIMJXzUZkA=="], ["created_at", "2020-11-22 01:03:56.246511"], ["updated_at", "2020-11-22 01:03:56.246511"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.3ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMTMsImV4cCI6MTYwNjE3OTgzNn0.HXQX6HM-Ta3YILzEWIckVyLUFxVAg-EzSVEaTKEY6IQ"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMTMsImV4cCI6MTYwNjE3OTgzNn0.HXQX6HM-Ta3YILzEWIckVyLUFxVAg-EzSVEaTKEY6IQ"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (2.1ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMTMsImV4cCI6MTYwNjE3OTgzNn0.HXQX6HM-Ta3YILzEWIckVyLUFxVAg-EzSVEaTKEY6IQ"], ["exp_date", "2020-11-24 01:03:56"], ["resource_type", "User"], ["resource_id", 113], ["created_at", "2020-11-22 01:03:56.294708"], ["updated_at", "2020-11-22 01:03:56.294708"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/user/check_token?access_token=eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMTMsImV4cCI6MTYwNjE3OTgzNn0.HXQX6HM-Ta3YILzEWIckVyLUFxVAg-EzSVEaTKEY6IQ" for 127.0.0.1 at 2020-11-22 02:03:56 +0100
Processing by SecureApi::SecureApiController#check_token as HTML
  Parameters: {"access_token"=>"eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMTMsImV4cCI6MTYwNjE3OTgzNn0.HXQX6HM-Ta3YILzEWIckVyLUFxVAg-EzSVEaTKEY6IQ"}
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMTMsImV4cCI6MTYwNjE3OTgzNn0.HXQX6HM-Ta3YILzEWIckVyLUFxVAg-EzSVEaTKEY6IQ"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 113], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."resource_id" = $1 AND "secure_api_tokens"."resource_type" = $2 LIMIT $3[0m  [["resource_id", 113], ["resource_type", "User"], ["LIMIT", 1]]
Completed 200 OK in 9ms (Views: 0.2ms | ActiveRecord: 0.6ms | Allocations: 2469)
Started GET "/user/check_token?access_token=eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMTMsImV4cCI6MTYwNjE3OTgzNn0.HXQX6HM-Ta3YILzEWIckVyLUFxVAg-EzSVEaTKEY6IQ" for 127.0.0.1 at 2020-11-25 02:03:56 +0100
Processing by SecureApi::SecureApiController#check_token as HTML
  Parameters: {"access_token"=>"eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMTMsImV4cCI6MTYwNjE3OTgzNn0.HXQX6HM-Ta3YILzEWIckVyLUFxVAg-EzSVEaTKEY6IQ"}
  [1m[36mSecureApi::Token Load (0.3ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMTMsImV4cCI6MTYwNjE3OTgzNn0.HXQX6HM-Ta3YILzEWIckVyLUFxVAg-EzSVEaTKEY6IQ"], ["LIMIT", 1]]
Completed 401 Unauthorized in 1ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 342)
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
SecureApi::SecureApiControllerTest: test_logout
-----------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "29cb6b1171ca2cf3c027d8248c30dec6d1b3ed76ad8b7527d77369b04725edea$$O7XWNXW7TfMT6R+JTWdyhQ==--ivOfH7t3Uk6Qw+Hb--GsDZLVuUIliEngJRyyABFw=="], ["created_at", "2020-11-22 01:03:56.380559"], ["updated_at", "2020-11-22 01:03:56.380559"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
Started DELETE "/user/logout" for 127.0.0.1 at 2020-11-22 02:03:56 +0100
Processing by SecureApi::SecureApiController#logout as HTML
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
Completed 401 Unauthorized in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 324)
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMTQsImV4cCI6MTYwNjE3OTgzNn0._w6jVkXQEMbNY7-u9LIcTuf16J7597x-4xOfEENWzDo"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMTQsImV4cCI6MTYwNjE3OTgzNn0._w6jVkXQEMbNY7-u9LIcTuf16J7597x-4xOfEENWzDo"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMTQsImV4cCI6MTYwNjE3OTgzNn0._w6jVkXQEMbNY7-u9LIcTuf16J7597x-4xOfEENWzDo"], ["exp_date", "2020-11-24 01:03:56"], ["resource_type", "User"], ["resource_id", 114], ["created_at", "2020-11-22 01:03:56.397463"], ["updated_at", "2020-11-22 01:03:56.397463"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
Started DELETE "/user/logout" for 127.0.0.1 at 2020-11-22 02:03:56 +0100
Processing by SecureApi::SecureApiController#logout as HTML
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMTQsImV4cCI6MTYwNjE3OTgzNn0._w6jVkXQEMbNY7-u9LIcTuf16J7597x-4xOfEENWzDo"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Destroy (0.2ms)[0m  [1m[31mDELETE FROM "secure_api_tokens" WHERE "secure_api_tokens"."id" = $1[0m  [["id", 87]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 1ms (ActiveRecord: 0.6ms | Allocations: 363)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
SecureApi::SecureApiControllerTest: test_login
----------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "479df360001e2012077fba4b33c85326d074a892a5c7d4373a0f790490eda724$$7iSX9IElsDs328Y/LjjHqw==--9WmF5XmXhBXBnhfx--4DDhQ0iCTTAazPTl+WmR3w=="], ["created_at", "2020-11-22 01:03:56.453544"], ["updated_at", "2020-11-22 01:03:56.453544"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
Started POST "/user/login" for 127.0.0.1 at 2020-11-22 02:03:56 +0100
Processing by SecureApi::SecureApiController#login as HTML
  Parameters: {"email"=>"name@example.com", "password"=>"[FILTERED]"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "name@example.com"], ["LIMIT", 1]]
Completed 401 Unauthorized in 46ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 463)
  [1m[35m (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
Started POST "/user/login" for 127.0.0.1 at 2020-11-22 02:03:56 +0100
Processing by SecureApi::SecureApiController#login as HTML
  Parameters: {"email"=>"name@example.com", "password"=>"[FILTERED]"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "name@example.com"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Load (0.4ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."resource_id" = $1 AND "secure_api_tokens"."resource_type" = $2 LIMIT $3[0m  [["resource_id", 115], ["resource_type", "User"], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMTUsImV4cCI6MTYwNjE3OTgzNn0.mwSvAM82_wxKB0ioNLCoC-F8BWKmvB7vBcQ-3NUqtqY"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMTUsImV4cCI6MTYwNjE3OTgzNn0.mwSvAM82_wxKB0ioNLCoC-F8BWKmvB7vBcQ-3NUqtqY"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.3ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMTUsImV4cCI6MTYwNjE3OTgzNn0.mwSvAM82_wxKB0ioNLCoC-F8BWKmvB7vBcQ-3NUqtqY"], ["exp_date", "2020-11-24 01:03:56"], ["resource_type", "User"], ["resource_id", 115], ["created_at", "2020-11-22 01:03:56.570356"], ["updated_at", "2020-11-22 01:03:56.570356"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 115], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."resource_id" = $1 AND "secure_api_tokens"."resource_type" = $2 LIMIT $3[0m  [["resource_id", 115], ["resource_type", "User"], ["LIMIT", 1]]
Completed 200 OK in 58ms (Views: 0.2ms | ActiveRecord: 1.9ms | Allocations: 1963)
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
Started POST "/user/login" for 127.0.0.1 at 2020-11-22 02:03:56 +0100
Processing by SecureApi::SecureApiController#login as HTML
  Parameters: {"email"=>"name@example.com"}
Completed 401 Unauthorized in 0ms (Views: 0.1ms | ActiveRecord: 0.0ms | Allocations: 139)
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------
NavigationTest: test_reject_unauthorized_requests
-------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "2ddacf222e9fc6d2343b06efb66ca11b01c6f00219d1a20146ee1978bc54d051$$DeCqq4JoiuChqwgEIrw7cQ==--gPUVfETa8wY3rCDy--21NPEHJ7evKHDH+CDqjDgA=="], ["created_at", "2020-11-22 01:03:56.628125"], ["updated_at", "2020-11-22 01:03:56.628125"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/" for 127.0.0.1 at 2020-11-22 02:03:56 +0100
Processing by ApplicationController#root as HTML
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
Filter chain halted as :authenticate_request! rendered or redirected
Completed 401 Unauthorized in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 342)
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
SecureApi::TokenTest: test_is_expired
-------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "075b5b7ef998a51c1b6247b4ace5cbb516536aad38b55dc302067fffb5afbb1e$$P7OlGFF85RmI5ai8t0IP1A==--+0qLnEbl/hhjwHIJ--vI2Q8tAuyXeswXqjI6mznQ=="], ["created_at", "2020-11-22 01:03:56.683079"], ["updated_at", "2020-11-22 01:03:56.683079"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.1ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMTcsImV4cCI6MTYwNjE3OTgzNn0.WnUnScnr0MCvGzrkWQGjCkEHj7NNLCK51-GOJg-qrCI"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMTcsImV4cCI6MTYwNjE3OTgzNn0.WnUnScnr0MCvGzrkWQGjCkEHj7NNLCK51-GOJg-qrCI"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMTcsImV4cCI6MTYwNjE3OTgzNn0.WnUnScnr0MCvGzrkWQGjCkEHj7NNLCK51-GOJg-qrCI"], ["exp_date", "2020-11-24 01:03:56"], ["resource_type", "User"], ["resource_id", 117], ["created_at", "2020-11-22 01:03:56.685904"], ["updated_at", "2020-11-22 01:03:56.685904"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------
SecureApi::TokenTest: test_is_ok
--------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "8745626ef0eec83a22044fc21e167042077d70c8690ac953ef0dc6ad5be6614a$$6KggjfWygvt1eH8dccCujA==--X8hbBkP/AhP6RV+Z--GNfZzwEZJG1LbXU8QrVNbw=="], ["created_at", "2020-11-22 01:03:56.733689"], ["updated_at", "2020-11-22 01:03:56.733689"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.1ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMTgsImV4cCI6MTYwNjE3OTgzNn0.ZoukoRH7iD3RtIUCXxgd8N41lziuM1Z6YSKOv32Wyjc"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMTgsImV4cCI6MTYwNjE3OTgzNn0.ZoukoRH7iD3RtIUCXxgd8N41lziuM1Z6YSKOv32Wyjc"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMTgsImV4cCI6MTYwNjE3OTgzNn0.ZoukoRH7iD3RtIUCXxgd8N41lziuM1Z6YSKOv32Wyjc"], ["exp_date", "2020-11-24 01:03:56"], ["resource_type", "User"], ["resource_id", 118], ["created_at", "2020-11-22 01:03:56.736435"], ["updated_at", "2020-11-22 01:03:56.736435"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------
SecureApi::TokenTest: test_set_token
------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "0f42e76469fe3bba3d25043b9125614b665b2c17f637a47e167eb1ec21b91545$$bHJpEzIX04cUl/gsA7giNA==--mtu8yTE9BdPCFh3R--2wI4GqdYo4+zp8CUWkmt8w=="], ["created_at", "2020-11-22 01:03:56.784452"], ["updated_at", "2020-11-22 01:03:56.784452"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.1ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMTksImV4cCI6MTYwNjE3OTgzNn0.IzSMCrVJYauNLYSXKbi7ErVeCFgpcK0RY_HDH_92lXE"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMTksImV4cCI6MTYwNjE3OTgzNn0.IzSMCrVJYauNLYSXKbi7ErVeCFgpcK0RY_HDH_92lXE"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.4ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMTksImV4cCI6MTYwNjE3OTgzNn0.IzSMCrVJYauNLYSXKbi7ErVeCFgpcK0RY_HDH_92lXE"], ["exp_date", "2020-11-24 01:03:56"], ["resource_type", "User"], ["resource_id", 119], ["created_at", "2020-11-22 01:03:56.786852"], ["updated_at", "2020-11-22 01:03:56.786852"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------
SecureApi::TokenTest: test_decode
---------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "629a131e1b8f044ee9c6f8426fc0597a8cd5f5499a985e7f39ce31e51cd51b91$$T4AI3sBpvNT3/ieUpBYa3Q==--f+gz8L+D7gJ3Rc2p--9E+P9sJdzdDcOXqZJhF9YQ=="], ["created_at", "2020-11-22 01:03:56.833960"], ["updated_at", "2020-11-22 01:03:56.833960"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.1ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMjAsImV4cCI6MTYwNjE3OTgzNn0.03906nPM96ADg7NXSfwvrJeUbGZPqt4x5GW3c7ho4OI"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMjAsImV4cCI6MTYwNjE3OTgzNn0.03906nPM96ADg7NXSfwvrJeUbGZPqt4x5GW3c7ho4OI"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMjAsImV4cCI6MTYwNjE3OTgzNn0.03906nPM96ADg7NXSfwvrJeUbGZPqt4x5GW3c7ho4OI"], ["exp_date", "2020-11-24 01:03:56"], ["resource_type", "User"], ["resource_id", 120], ["created_at", "2020-11-22 01:03:56.836371"], ["updated_at", "2020-11-22 01:03:56.836371"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------
SecureApi::Test: test_truth
---------------------------
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------
NavigationTest: test_reject_unauthorized_requests
-------------------------------------------------
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "4b5456a21171b830de758099bf79c4f37ae48fa537a6c61e0b56186f5f7d8c08$$M5tyUK/ycfMljBLdz/9tFA==--w3NTNg9PxqifBahR--WN9dKZ0Kq/yi21AxJRkQ0A=="], ["created_at", "2020-11-22 01:04:55.208854"], ["updated_at", "2020-11-22 01:04:55.208854"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
SecureApi::SecureApiControllerTest: test_login
----------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "06cf706eeb8613d7c435da13e7de446cbce88578eeb1883c2d1b50b3745daa44$$X7Tx/cdMajBmBPqY/nnF/A==--3gtgr0gLaPY5klrb--APhMjW9xjFcLgO8g3vlPNw=="], ["created_at", "2020-11-22 01:04:55.260863"], ["updated_at", "2020-11-22 01:04:55.260863"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
Started POST "/user/login" for 127.0.0.1 at 2020-11-22 02:04:55 +0100
Processing by SecureApi::SecureApiController#login as HTML
  Parameters: {"email"=>"name@example.com", "password"=>"[FILTERED]"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "name@example.com"], ["LIMIT", 1]]
Completed 401 Unauthorized in 47ms (Views: 0.2ms | ActiveRecord: 0.4ms | Allocations: 641)
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
Started POST "/user/login" for 127.0.0.1 at 2020-11-22 02:04:55 +0100
Processing by SecureApi::SecureApiController#login as HTML
  Parameters: {"email"=>"name@example.com", "password"=>"[FILTERED]"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "name@example.com"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Load (0.3ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."resource_id" = $1 AND "secure_api_tokens"."resource_type" = $2 LIMIT $3[0m  [["resource_id", 122], ["resource_type", "User"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMjIsImV4cCI6MTYwNjE3OTg5NX0.RSt4-bFNYE_hmcJFYZDqXjEvKJ6YYkiuL8-_avnanHg"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMjIsImV4cCI6MTYwNjE3OTg5NX0.RSt4-bFNYE_hmcJFYZDqXjEvKJ6YYkiuL8-_avnanHg"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.4ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMjIsImV4cCI6MTYwNjE3OTg5NX0.RSt4-bFNYE_hmcJFYZDqXjEvKJ6YYkiuL8-_avnanHg"], ["exp_date", "2020-11-24 01:04:55"], ["resource_type", "User"], ["resource_id", 122], ["created_at", "2020-11-22 01:04:55.426608"], ["updated_at", "2020-11-22 01:04:55.426608"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 122], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."resource_id" = $1 AND "secure_api_tokens"."resource_type" = $2 LIMIT $3[0m  [["resource_id", 122], ["resource_type", "User"], ["LIMIT", 1]]
Completed 200 OK in 70ms (Views: 0.2ms | ActiveRecord: 3.5ms | Allocations: 8122)
  [1m[35m (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
Started POST "/user/login" for 127.0.0.1 at 2020-11-22 02:04:55 +0100
Processing by SecureApi::SecureApiController#login as HTML
  Parameters: {"email"=>"name@example.com"}
Completed 401 Unauthorized in 0ms (Views: 0.1ms | ActiveRecord: 0.0ms | Allocations: 139)
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
SecureApi::SecureApiControllerTest: test_check_token
----------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "1ce3c25a411e6e8042f3b4749663359a7b1e5c061ddaf885501661a119edb860$$RbWNeqMQFzdJAvMqHTjp/Q==--rzRCDJgHBpWRVi65--tmfgRiUDHdf3OnpARHXbvw=="], ["created_at", "2020-11-22 01:04:55.485104"], ["updated_at", "2020-11-22 01:04:55.485104"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMjMsImV4cCI6MTYwNjE3OTg5NX0.1YMRM5nhG9pezyqftZgO4VDYJQ6JDizgkyCgUD7tuns"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMjMsImV4cCI6MTYwNjE3OTg5NX0.1YMRM5nhG9pezyqftZgO4VDYJQ6JDizgkyCgUD7tuns"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMjMsImV4cCI6MTYwNjE3OTg5NX0.1YMRM5nhG9pezyqftZgO4VDYJQ6JDizgkyCgUD7tuns"], ["exp_date", "2020-11-24 01:04:55"], ["resource_type", "User"], ["resource_id", 123], ["created_at", "2020-11-22 01:04:55.488141"], ["updated_at", "2020-11-22 01:04:55.488141"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/user/check_token?access_token=eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMjMsImV4cCI6MTYwNjE3OTg5NX0.1YMRM5nhG9pezyqftZgO4VDYJQ6JDizgkyCgUD7tuns" for 127.0.0.1 at 2020-11-22 02:04:55 +0100
Processing by SecureApi::SecureApiController#check_token as HTML
  Parameters: {"access_token"=>"eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMjMsImV4cCI6MTYwNjE3OTg5NX0.1YMRM5nhG9pezyqftZgO4VDYJQ6JDizgkyCgUD7tuns"}
  [1m[36mSecureApi::Token Load (0.3ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMjMsImV4cCI6MTYwNjE3OTg5NX0.1YMRM5nhG9pezyqftZgO4VDYJQ6JDizgkyCgUD7tuns"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 123], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."resource_id" = $1 AND "secure_api_tokens"."resource_type" = $2 LIMIT $3[0m  [["resource_id", 123], ["resource_type", "User"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.2ms | ActiveRecord: 0.7ms | Allocations: 1184)
Started GET "/user/check_token?access_token=eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMjMsImV4cCI6MTYwNjE3OTg5NX0.1YMRM5nhG9pezyqftZgO4VDYJQ6JDizgkyCgUD7tuns" for 127.0.0.1 at 2020-11-25 02:04:55 +0100
Processing by SecureApi::SecureApiController#check_token as HTML
  Parameters: {"access_token"=>"eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMjMsImV4cCI6MTYwNjE3OTg5NX0.1YMRM5nhG9pezyqftZgO4VDYJQ6JDizgkyCgUD7tuns"}
  [1m[36mSecureApi::Token Load (0.3ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMjMsImV4cCI6MTYwNjE3OTg5NX0.1YMRM5nhG9pezyqftZgO4VDYJQ6JDizgkyCgUD7tuns"], ["LIMIT", 1]]
Completed 401 Unauthorized in 1ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 342)
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
SecureApi::SecureApiControllerTest: test_logout
-----------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "aea4a9f448ece02c232fd10ad1e8f512da6859ffd7a2f83ee7471e14dcb7844d$$dp8ziyZi0gxB/PwDiAUu7w==--xm1XyIXucockWLoO--qPQRuj0cg5l7iXK2Ty4EMw=="], ["created_at", "2020-11-22 01:04:55.553895"], ["updated_at", "2020-11-22 01:04:55.553895"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
Started DELETE "/user/logout" for 127.0.0.1 at 2020-11-22 02:04:55 +0100
Processing by SecureApi::SecureApiController#logout as HTML
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
Completed 401 Unauthorized in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 321)
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMjQsImV4cCI6MTYwNjE3OTg5NX0.AcD7MlK10IJpJlLfyi2jWWRpEIgoAx4qnWbOft9o-3Y"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMjQsImV4cCI6MTYwNjE3OTg5NX0.AcD7MlK10IJpJlLfyi2jWWRpEIgoAx4qnWbOft9o-3Y"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMjQsImV4cCI6MTYwNjE3OTg5NX0.AcD7MlK10IJpJlLfyi2jWWRpEIgoAx4qnWbOft9o-3Y"], ["exp_date", "2020-11-24 01:04:55"], ["resource_type", "User"], ["resource_id", 124], ["created_at", "2020-11-22 01:04:55.565990"], ["updated_at", "2020-11-22 01:04:55.565990"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
Started DELETE "/user/logout" for 127.0.0.1 at 2020-11-22 02:04:55 +0100
Processing by SecureApi::SecureApiController#logout as HTML
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMjQsImV4cCI6MTYwNjE3OTg5NX0.AcD7MlK10IJpJlLfyi2jWWRpEIgoAx4qnWbOft9o-3Y"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Destroy (0.2ms)[0m  [1m[31mDELETE FROM "secure_api_tokens" WHERE "secure_api_tokens"."id" = $1[0m  [["id", 95]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 2ms (ActiveRecord: 0.6ms | Allocations: 362)
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------
SecureApi::Test: test_truth
---------------------------
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------
SecureApi::TokenTest: test_decode
---------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "30bd830fad8b1782f443590de623f0a1448c044c0b6c337f6d582ee770fc8518$$h+8qJYYPWtZ09e0j2VOE+w==--xRhOOtcAmSupQ3tJ--zVoMB8X5KjenEVQKjpYZog=="], ["created_at", "2020-11-22 01:04:55.623027"], ["updated_at", "2020-11-22 01:04:55.623027"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.1ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMjUsImV4cCI6MTYwNjE3OTg5NX0.As9n26-4QNIhmFEBAWlwMn_1iAEscDWbqNv0N3daMZo"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMjUsImV4cCI6MTYwNjE3OTg5NX0.As9n26-4QNIhmFEBAWlwMn_1iAEscDWbqNv0N3daMZo"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.3ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMjUsImV4cCI6MTYwNjE3OTg5NX0.As9n26-4QNIhmFEBAWlwMn_1iAEscDWbqNv0N3daMZo"], ["exp_date", "2020-11-24 01:04:55"], ["resource_type", "User"], ["resource_id", 125], ["created_at", "2020-11-22 01:04:55.625540"], ["updated_at", "2020-11-22 01:04:55.625540"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
SecureApi::TokenTest: test_is_expired
-------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "0019f607c05dc2cfda1ace89ce93b087aba985539fae8eb0d6df8bd7389fa565$$ek9hTrU6ZWswwiOtFw8Z7A==--0KNAU4inSH6FXtfM--DNqdOhmR3cBG1rxcc18thg=="], ["created_at", "2020-11-22 01:04:55.672384"], ["updated_at", "2020-11-22 01:04:55.672384"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.1ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMjYsImV4cCI6MTYwNjE3OTg5NX0.-h1uonrub8pmecDziujFvKOdI_08Tqy0J3Q9anfal28"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMjYsImV4cCI6MTYwNjE3OTg5NX0.-h1uonrub8pmecDziujFvKOdI_08Tqy0J3Q9anfal28"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.1ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMjYsImV4cCI6MTYwNjE3OTg5NX0.-h1uonrub8pmecDziujFvKOdI_08Tqy0J3Q9anfal28"], ["exp_date", "2020-11-24 01:04:55"], ["resource_type", "User"], ["resource_id", 126], ["created_at", "2020-11-22 01:04:55.675340"], ["updated_at", "2020-11-22 01:04:55.675340"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
--------------------------------
SecureApi::TokenTest: test_is_ok
--------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "cedc4c0bdfd98daab3d6736a458b54bfd7d2f980dcfc089a5747f67cda257e33$$G+4WB5edKbCHtb77c0koxA==--YDt5o86CtiHsKKPR--xFGSWII06r/fzMT7UVJhlw=="], ["created_at", "2020-11-22 01:04:55.723507"], ["updated_at", "2020-11-22 01:04:55.723507"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMjcsImV4cCI6MTYwNjE3OTg5NX0.8xDFAYBcrFGmZtl_sqJdmp0bcumxAmGdMWVuT8gj_Xg"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMjcsImV4cCI6MTYwNjE3OTg5NX0.8xDFAYBcrFGmZtl_sqJdmp0bcumxAmGdMWVuT8gj_Xg"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMjcsImV4cCI6MTYwNjE3OTg5NX0.8xDFAYBcrFGmZtl_sqJdmp0bcumxAmGdMWVuT8gj_Xg"], ["exp_date", "2020-11-24 01:04:55"], ["resource_type", "User"], ["resource_id", 127], ["created_at", "2020-11-22 01:04:55.726612"], ["updated_at", "2020-11-22 01:04:55.726612"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------
SecureApi::TokenTest: test_set_token
------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "6f480dde527a4689e4839f9ad32af8c4626fda32ab4a76b48add4b048af701b6$$3j2phJYeKeWqbDfcqMaThQ==--BHyKCT4er6pdeIUd--2jEmbbtOIIxHw6hfFV1kww=="], ["created_at", "2020-11-22 01:04:55.775492"], ["updated_at", "2020-11-22 01:04:55.775492"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMjgsImV4cCI6MTYwNjE3OTg5NX0.VtjtZXYc3BpJ-R-GPLD_YuSx4LkS8cFv8TbsK1WKPqM"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMjgsImV4cCI6MTYwNjE3OTg5NX0.VtjtZXYc3BpJ-R-GPLD_YuSx4LkS8cFv8TbsK1WKPqM"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.3ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMjgsImV4cCI6MTYwNjE3OTg5NX0.VtjtZXYc3BpJ-R-GPLD_YuSx4LkS8cFv8TbsK1WKPqM"], ["exp_date", "2020-11-24 01:04:55"], ["resource_type", "User"], ["resource_id", 128], ["created_at", "2020-11-22 01:04:55.778591"], ["updated_at", "2020-11-22 01:04:55.778591"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1[0m  [["key", "schema_sha1"]]
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------
NavigationTest: test_reject_unauthorized_requests
-------------------------------------------------
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.7ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "a3b286a1821c3af781ac97fba3702e6dde0941735c031b0bb16ee35e51bc17b5$$nztbN/87mK4joaCf6LWQCA==--Ix02USraCPzGDJpV--ITbm9SVGEOqEwzbBHfh+xQ=="], ["created_at", "2020-11-22 01:05:12.783925"], ["updated_at", "2020-11-22 01:05:12.783925"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.4ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMjksImV4cCI6MTYwNjE3OTkxMn0.BqDbjCDVxu_aPhuEuzLP0EkQ24-Tc9-V2kDZYdBKIBs"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMjksImV4cCI6MTYwNjE3OTkxMn0.BqDbjCDVxu_aPhuEuzLP0EkQ24-Tc9-V2kDZYdBKIBs"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.3ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMjksImV4cCI6MTYwNjE3OTkxMn0.BqDbjCDVxu_aPhuEuzLP0EkQ24-Tc9-V2kDZYdBKIBs"], ["exp_date", "2020-11-24 01:05:12"], ["resource_type", "User"], ["resource_id", 129], ["created_at", "2020-11-22 01:05:12.819147"], ["updated_at", "2020-11-22 01:05:12.819147"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/" for 127.0.0.1 at 2020-11-22 02:05:12 +0100
Processing by ApplicationController#root as HTML
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
Filter chain halted as :authenticate_request! rendered or redirected
Completed 401 Unauthorized in 1ms (Views: 0.2ms | ActiveRecord: 0.2ms | Allocations: 394)
Started GET "/" for 127.0.0.1 at 2020-11-22 02:05:12 +0100
Processing by ApplicationController#root as HTML
  [1m[36mSecureApi::Token Load (0.3ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMjksImV4cCI6MTYwNjE3OTkxMn0.BqDbjCDVxu_aPhuEuzLP0EkQ24-Tc9-V2kDZYdBKIBs"], ["LIMIT", 1]]
Completed 204 No Content in 1ms (ActiveRecord: 0.3ms | Allocations: 300)
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
SecureApi::SecureApiControllerTest: test_login
----------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "d77646f1a4964e737f597f2411c09894f2768f26c2b91c50e946d5fbc26ee1dd$$XH/CY8dVlFg3eKI0pceOdA==--91UgTUEwHGvhYTUz--jdv8QbtfzBQUDbapUwa1sA=="], ["created_at", "2020-11-22 01:05:12.892196"], ["updated_at", "2020-11-22 01:05:12.892196"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
Started POST "/user/login" for 127.0.0.1 at 2020-11-22 02:05:12 +0100
Processing by SecureApi::SecureApiController#login as HTML
  Parameters: {"email"=>"name@example.com", "password"=>"[FILTERED]"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "name@example.com"], ["LIMIT", 1]]
Completed 401 Unauthorized in 48ms (Views: 0.2ms | ActiveRecord: 0.3ms | Allocations: 517)
  [1m[35m (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
Started POST "/user/login" for 127.0.0.1 at 2020-11-22 02:05:12 +0100
Processing by SecureApi::SecureApiController#login as HTML
  Parameters: {"email"=>"name@example.com", "password"=>"[FILTERED]"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "name@example.com"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Load (0.3ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."resource_id" = $1 AND "secure_api_tokens"."resource_type" = $2 LIMIT $3[0m  [["resource_id", 130], ["resource_type", "User"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.1ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMzAsImV4cCI6MTYwNjE3OTkxM30.K7c29UUCl3xTM1-V1Nsfenrd97yWjiMDHuyp_CsG95s"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMzAsImV4cCI6MTYwNjE3OTkxM30.K7c29UUCl3xTM1-V1Nsfenrd97yWjiMDHuyp_CsG95s"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMzAsImV4cCI6MTYwNjE3OTkxM30.K7c29UUCl3xTM1-V1Nsfenrd97yWjiMDHuyp_CsG95s"], ["exp_date", "2020-11-24 01:05:13"], ["resource_type", "User"], ["resource_id", 130], ["created_at", "2020-11-22 01:05:13.015417"], ["updated_at", "2020-11-22 01:05:13.015417"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 130], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Load (0.1ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."resource_id" = $1 AND "secure_api_tokens"."resource_type" = $2 LIMIT $3[0m  [["resource_id", 130], ["resource_type", "User"], ["LIMIT", 1]]
Completed 200 OK in 55ms (Views: 0.1ms | ActiveRecord: 1.4ms | Allocations: 3124)
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
Started POST "/user/login" for 127.0.0.1 at 2020-11-22 02:05:13 +0100
Processing by SecureApi::SecureApiController#login as HTML
  Parameters: {"email"=>"name@example.com"}
Completed 401 Unauthorized in 0ms (Views: 0.1ms | ActiveRecord: 0.0ms | Allocations: 139)
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
SecureApi::SecureApiControllerTest: test_logout
-----------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "9f692982d555843f9e4173a4f6acd925b6b08a8e48a966284c6235f0bdac3a5c$$XJ6Zw6V1XvTVC5ywCfB7ow==--4Y5SdvtDWMwXmvyb--UKH5UPfoAcrJYMjWKBPL1Q=="], ["created_at", "2020-11-22 01:05:13.070748"], ["updated_at", "2020-11-22 01:05:13.070748"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
Started DELETE "/user/logout" for 127.0.0.1 at 2020-11-22 02:05:13 +0100
Processing by SecureApi::SecureApiController#logout as HTML
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
Completed 401 Unauthorized in 1ms (Views: 0.1ms | ActiveRecord: 0.2ms | Allocations: 316)
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.1ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMzEsImV4cCI6MTYwNjE3OTkxM30.pqDLp-leEhUkGlIawVhIraLRvUpZF4-EFTEFc9MzQVE"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMzEsImV4cCI6MTYwNjE3OTkxM30.pqDLp-leEhUkGlIawVhIraLRvUpZF4-EFTEFc9MzQVE"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMzEsImV4cCI6MTYwNjE3OTkxM30.pqDLp-leEhUkGlIawVhIraLRvUpZF4-EFTEFc9MzQVE"], ["exp_date", "2020-11-24 01:05:13"], ["resource_type", "User"], ["resource_id", 131], ["created_at", "2020-11-22 01:05:13.081032"], ["updated_at", "2020-11-22 01:05:13.081032"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
Started DELETE "/user/logout" for 127.0.0.1 at 2020-11-22 02:05:13 +0100
Processing by SecureApi::SecureApiController#logout as HTML
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMzEsImV4cCI6MTYwNjE3OTkxM30.pqDLp-leEhUkGlIawVhIraLRvUpZF4-EFTEFc9MzQVE"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Destroy (0.2ms)[0m  [1m[31mDELETE FROM "secure_api_tokens" WHERE "secure_api_tokens"."id" = $1[0m  [["id", 102]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 2ms (ActiveRecord: 0.6ms | Allocations: 359)
  [1m[35m (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "secure_api_tokens"[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
SecureApi::SecureApiControllerTest: test_check_token
----------------------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "f03e72c82d5ade8cfc349b5dfbf22d19ec67ec6a39d7483197ce8b936034d82c$$UrgpJFiiqOLofvQGnYtLFw==--c5Zy+2CZRLzVf58w--Usvn1K0zvh5ebabo99hc2Q=="], ["created_at", "2020-11-22 01:05:13.135970"], ["updated_at", "2020-11-22 01:05:13.135970"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMzIsImV4cCI6MTYwNjE3OTkxM30.2sPPEvp6KwuyHUmYqDvC8hB2F2PbreH3uXZCkciWfUA"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMzIsImV4cCI6MTYwNjE3OTkxM30.2sPPEvp6KwuyHUmYqDvC8hB2F2PbreH3uXZCkciWfUA"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMzIsImV4cCI6MTYwNjE3OTkxM30.2sPPEvp6KwuyHUmYqDvC8hB2F2PbreH3uXZCkciWfUA"], ["exp_date", "2020-11-24 01:05:13"], ["resource_type", "User"], ["resource_id", 132], ["created_at", "2020-11-22 01:05:13.138575"], ["updated_at", "2020-11-22 01:05:13.138575"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/user/check_token?access_token=eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMzIsImV4cCI6MTYwNjE3OTkxM30.2sPPEvp6KwuyHUmYqDvC8hB2F2PbreH3uXZCkciWfUA" for 127.0.0.1 at 2020-11-22 02:05:13 +0100
Processing by SecureApi::SecureApiController#check_token as HTML
  Parameters: {"access_token"=>"eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMzIsImV4cCI6MTYwNjE3OTkxM30.2sPPEvp6KwuyHUmYqDvC8hB2F2PbreH3uXZCkciWfUA"}
  [1m[36mSecureApi::Token Load (0.2ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMzIsImV4cCI6MTYwNjE3OTkxM30.2sPPEvp6KwuyHUmYqDvC8hB2F2PbreH3uXZCkciWfUA"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 132], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Load (0.1ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."resource_id" = $1 AND "secure_api_tokens"."resource_type" = $2 LIMIT $3[0m  [["resource_id", 132], ["resource_type", "User"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.5ms | Allocations: 1183)
Started GET "/user/check_token?access_token=eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMzIsImV4cCI6MTYwNjE3OTkxM30.2sPPEvp6KwuyHUmYqDvC8hB2F2PbreH3uXZCkciWfUA" for 127.0.0.1 at 2020-11-25 02:05:13 +0100
Processing by SecureApi::SecureApiController#check_token as HTML
  Parameters: {"access_token"=>"eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMzIsImV4cCI6MTYwNjE3OTkxM30.2sPPEvp6KwuyHUmYqDvC8hB2F2PbreH3uXZCkciWfUA"}
  [1m[36mSecureApi::Token Load (0.3ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMzIsImV4cCI6MTYwNjE3OTkxM30.2sPPEvp6KwuyHUmYqDvC8hB2F2PbreH3uXZCkciWfUA"], ["LIMIT", 1]]
Completed 401 Unauthorized in 1ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 342)
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------
SecureApi::TokenTest: test_decode
---------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "b08fb32f934a59ed9504508b50dc8d9e0ba02d75d64a97ed9d16cd5cde9a41bc$$W9rbt6rqsZPPPAZ5Jto7DA==--6gck4+nC52i59VKb--7+O2t/AfDy6/lkFOyYZb6g=="], ["created_at", "2020-11-22 01:05:13.202632"], ["updated_at", "2020-11-22 01:05:13.202632"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.1ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMzMsImV4cCI6MTYwNjE3OTkxM30.I65DHVD03AutOQSDYH8gtvWlf4iFecitzhZkk26_5Ec"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMzMsImV4cCI6MTYwNjE3OTkxM30.I65DHVD03AutOQSDYH8gtvWlf4iFecitzhZkk26_5Ec"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMzMsImV4cCI6MTYwNjE3OTkxM30.I65DHVD03AutOQSDYH8gtvWlf4iFecitzhZkk26_5Ec"], ["exp_date", "2020-11-24 01:05:13"], ["resource_type", "User"], ["resource_id", 133], ["created_at", "2020-11-22 01:05:13.205950"], ["updated_at", "2020-11-22 01:05:13.205950"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
------------------------------------
SecureApi::TokenTest: test_set_token
------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "d2bfaf2c4667768bbf8870a58b9e0e309a8e4219d301e0e3ba977d7852f62b9a$$9Z4pdrqRQitq8Ce6mg+IcQ==--B1o95czOip6itdwp--YDwcEVBDySNFrv62wpTpHQ=="], ["created_at", "2020-11-22 01:05:13.253422"], ["updated_at", "2020-11-22 01:05:13.253422"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.1ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMzQsImV4cCI6MTYwNjE3OTkxM30.OHJiswPV1sYhQJXYWSywMZrlenu1_xN4063uk8RqU0U"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.1ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMzQsImV4cCI6MTYwNjE3OTkxM30.OHJiswPV1sYhQJXYWSywMZrlenu1_xN4063uk8RqU0U"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.1ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMzQsImV4cCI6MTYwNjE3OTkxM30.OHJiswPV1sYhQJXYWSywMZrlenu1_xN4063uk8RqU0U"], ["exp_date", "2020-11-24 01:05:13"], ["resource_type", "User"], ["resource_id", 134], ["created_at", "2020-11-22 01:05:13.255947"], ["updated_at", "2020-11-22 01:05:13.255947"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
SecureApi::TokenTest: test_is_expired
-------------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "0da8fff9af7cc093da33a185d2148f10ece5447bebf31f6ddaa23a574f79e2f7$$gF8pt83DL0u0W5LbL8YeDQ==--ShG6SMpYKqzHesw+--F1D/gTJkDTEk2l5werD3Ig=="], ["created_at", "2020-11-22 01:05:13.302304"], ["updated_at", "2020-11-22 01:05:13.302304"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.1ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMzUsImV4cCI6MTYwNjE3OTkxM30.EmVx9LTtzrkhJRtp6SvwSzZ5aLSHbFejqfCpY3WxKbY"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMzUsImV4cCI6MTYwNjE3OTkxM30.EmVx9LTtzrkhJRtp6SvwSzZ5aLSHbFejqfCpY3WxKbY"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMzUsImV4cCI6MTYwNjE3OTkxM30.EmVx9LTtzrkhJRtp6SvwSzZ5aLSHbFejqfCpY3WxKbY"], ["exp_date", "2020-11-24 01:05:13"], ["resource_type", "User"], ["resource_id", 135], ["created_at", "2020-11-22 01:05:13.304887"], ["updated_at", "2020-11-22 01:05:13.304887"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------
SecureApi::TokenTest: test_is_ok
--------------------------------
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Create (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "password", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["email", "name@example.com"], ["password", "21c185770ae211d9a05c08dc6fec7d7a137ba7aedaad19a00b91cd8394f78eaa$$xvuoxGgOz5LM+i/dna5dUQ==--ddghGjJwt6nlIRjZ--g7hEbmbdXM1SdLRvVffxzA=="], ["created_at", "2020-11-22 01:05:13.353974"], ["updated_at", "2020-11-22 01:05:13.353974"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mSecureApi::Token Load (0.1ms)[0m  [1m[34mSELECT "secure_api_tokens".* FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMzYsImV4cCI6MTYwNjE3OTkxM30.56zIvucaLInKPmrJ4p9WCtk60maxNJeVOi0iRbq_2l0"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Exists? (0.2ms)[0m  [1m[34mSELECT 1 AS one FROM "secure_api_tokens" WHERE "secure_api_tokens"."token" = $1 LIMIT $2[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMzYsImV4cCI6MTYwNjE3OTkxM30.56zIvucaLInKPmrJ4p9WCtk60maxNJeVOi0iRbq_2l0"], ["LIMIT", 1]]
  [1m[36mSecureApi::Token Create (0.2ms)[0m  [1m[32mINSERT INTO "secure_api_tokens" ("token", "exp_date", "resource_type", "resource_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["token", "eyJhbGciOiJIUzI1NiJ9.eyJkYXRhIjoxMzYsImV4cCI6MTYwNjE3OTkxM30.56zIvucaLInKPmrJ4p9WCtk60maxNJeVOi0iRbq_2l0"], ["exp_date", "2020-11-24 01:05:13"], ["resource_type", "User"], ["resource_id", 136], ["created_at", "2020-11-22 01:05:13.356708"], ["updated_at", "2020-11-22 01:05:13.356708"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.1ms)[0m  [1m[35mBEGIN[0m
---------------------------
SecureApi::Test: test_truth
---------------------------
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK[0m
